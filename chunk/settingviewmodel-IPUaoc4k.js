import{BaseViewModel as h,settingManager as t,SetUnitEvent as c,SetLanguageEvent as v,GetSupportLanguageEvent as g,SetQualityEvent as E,SetAutoSnappingEvent as S,SetPreciseVectorPathEvent as D,SetDisplayVectorFillEvent as U,SetOperationPromptEvent as P,SetAutoUpdateDeviceExtEvent as m,CheckAppVersionEvent as y,OpenAppUpdateUrlEvent as A,OpenPrivacyUrlEvent as f,OpenTermsUrlEvent as x,OpenSafetyUrlEvent as H,OpenProjectUrlEvent as O,OpenHelpCenterUrlEvent as b,OpenShopUrlEvent as V,SetImageFitEvent as w,SetIsPreciseDxfFileParseEvent as C,SetDxfValueEvent as k,SetDebugModeEvent as F,GetAllDebugData as M,sensorsTrack as i,EventNames as n,ButtonNames as s,getDomain as L}from"./main-f7BGirYr.js";import{watch as a}from"./importmap-vue-u6Q_1Jji.js";class q extends h{constructor(){super(),this.init(),this.initWatch()}async init(){const e=await window.MeApi.app.getAppVersion(),l=await window.MeApi.app.getAppBuildVersion();this.updateState({currentAppVersion:`${e} (${l})`})}initWatch(){super.initWatch(),a(()=>t.unit.value,e=>{this.updateState({unit:e.current})}),a(()=>t.quality.value,e=>{this.updateState({quality:e})}),a(()=>t.enable_snapping.value,e=>{this.updateState({isEnableSnapping:e})}),a(()=>t.accurate_hit_area.value,e=>{this.updateState({isAccurateHitArea:e})}),a(()=>t.display_vector_fill.value,e=>{this.updateState({isDisplayVectorFill:e})}),a(()=>t.operation_prompt.value,e=>{this.updateState({isEnableOperationPrompt:e})}),a(()=>t.autoUpdateDeviceExt.value,e=>{this.updateState({autoCheckExtUpdate:e})}),a(()=>t.image_fit.value,e=>{this.updateState({imageFit:e})}),a(()=>t.isParseDxfPrecise.value,e=>{this.updateState({isParseDxfPrecise:e})}),a(()=>t.parseDxfData.value,e=>{this.updateState({parseDxfData:e})}),a(()=>t.debugMode.value,e=>{this.updateState({debugMode:e})}),a(()=>t.lastCheckUpdateResult.value,e=>{this.updateState({checkUpdateResult:e})})}createState(){return{unit:t.unit.value.current,lang:t.langKey.value,langList:[],quality:t.quality.value,isEnableSnapping:t.enable_snapping.value,isAccurateHitArea:t.accurate_hit_area.value,isDisplayVectorFill:t.display_vector_fill.value,isEnableOperationPrompt:t.operation_prompt.value,currentAppVersion:"",checkUpdateResult:null,autoCheckExtUpdate:t.autoUpdateDeviceExt.value,imageFit:t.image_fit.value,isParseDxfPrecise:t.isParseDxfPrecise.value,parseDxfData:t.parseDxfData.value,debugMode:t.debugMode.value}}setEventHandler(){this.registerEventHandler(c,this.handleUnitEvent),this.registerEventHandler(v,this.handleLanguageEvent),this.registerEventHandler(g,this.handleGetSupportLanguageEvent),this.registerEventHandler(E,this.handleQualityEvent),this.registerEventHandler(S,this.handleAutoSnappingEvent),this.registerEventHandler(D,this.handlePreciseVectorPathEvent),this.registerEventHandler(U,this.handleDisplayVectorFillEvent),this.registerEventHandler(P,this.handleOperationPromptEvent),this.registerEventHandler(m,this.handleAutoUpdateDeviceExtEvent),this.registerEventHandler(y,this.handleCheckAppVersionEvent),this.registerEventHandler(A,this.handleOpenAppUpdateUrlEvent),this.registerEventHandler(f,this.handleOpenPrivacyPolicyEvent),this.registerEventHandler(x,this.handleOpenTermsEvent),this.registerEventHandler(H,this.handleOpenSafetyUrlEvent),this.registerEventHandler(O,this.handleOpenProjectUrlEvent),this.registerEventHandler(b,this.handleOpenHelpCenterUrlEvent),this.registerEventHandler(V,this.handleOpenShopUrlEvent),this.registerEventHandler(w,this.handleSetImageFitEvent),this.registerEventHandler(C,this.handlePreciseDxfFileParseEvent),this.registerEventHandler(k,this.handleSetDxfValueEvent),this.registerEventHandler(F,this.handleSetDebugModeEvent),this.registerEventHandler(M,this.getAllDebugData)}handleUnitEvent(e){i(n.adjustSetting,{name:"canvasUnit",type:e.unit}),t.updateUnit(e.unit),this.updateState({unit:e.unit})}handleLanguageEvent(e){i(n.adjustSetting,{name:"language",type:e.lang}),t.updateLangKey(e.lang),this.updateState({lang:e.lang})}handleGetSupportLanguageEvent(){const e=t.getSupportLangList();console.log("==> handleGetSupportLanguageEvent",e),this.updateState({langList:e||[]})}handleQualityEvent(e){i(n.adjustSetting,{name:"vectorQuality",type:e.quality}),t.updateQuality(e.quality),this.updateState({quality:e.quality})}handleAutoSnappingEvent(e){i(n.switch,{name:"autoSnapping",type:e.isAuto?"on":"off"}),t.updateEnableSnapping(e.isAuto),this.updateState({isEnableSnapping:e.isAuto})}handlePreciseVectorPathEvent(e){i(n.switch,{name:"preciseSelection",type:e.isPrecise?"on":"off"}),t.updateAccurateHitArea(e.isPrecise),this.updateState({isAccurateHitArea:e.isPrecise})}handleDisplayVectorFillEvent(e){i(n.switch,{name:"graphicFillStatus",type:e.isDisplay?"on":"off"}),t.updateDisplayVectorFill(e.isDisplay),this.updateState({isDisplayVectorFill:e.isDisplay})}handleOperationPromptEvent(e){i(n.switch,{name:"operationPrompt",type:e.isPrompt?"on":"off"}),t.updateOperationPrompt(e.isPrompt),this.updateState({isEnableOperationPrompt:e.isPrompt})}handleAutoUpdateDeviceExtEvent(e){i(n.switch,{name:"pluginAutoUpdate",type:e.isAuto?"on":"off"}),t.updateAutoUpdateDeviceExt(e.isAuto),this.updateState({autoCheckExtUpdate:t.isAutoUpdateDeviceExt()})}async handleCheckAppVersionEvent(e){console.log("==>handleCheckAppVersionEvent start");let l=!0;e&&e.isNeedShowDialog===!1&&(l=!1,console.log("==>handleCheckAppVersionEvent false")),await t.checkSoftUpdate(),await t.showUpdateDialog(!1,l),this.updateState({checkUpdateResult:t.lastCheckUpdateResult.value})}handleOpenAppUpdateUrlEvent(e){var l,r,p,u,d,o;e&&e.url?(l=window.MeApi)==null||l.updateAppVersion(e.url):(console.log("handleOpenAppUpdateUrlEvent: url is ",(p=(r=t.lastCheckUpdateResult)==null?void 0:r.value)==null?void 0:p.downloadUrl[0]),(o=window.MeApi)==null||o.updateAppVersion((d=(u=t.lastCheckUpdateResult)==null?void 0:u.value)==null?void 0:d.downloadUrl[0]))}handleOpenPrivacyPolicyEvent(){t.openPrivacyUrl()}handleOpenTermsEvent(){t.openTermsUrl()}handleOpenSafetyUrlEvent(){t.openSafetyUrl()}handleOpenProjectUrlEvent(){i(n.buttonClick,{elementId:s.xToolProjects}),t.openProjectUrl()}handleOpenHelpCenterUrlEvent(){i(n.buttonClick,{elementId:s.helpCenter}),t.openHelpCenterUrl()}handleOpenShopUrlEvent(){i(n.buttonClick,{elementId:s.shop}),t.openShopUrl()}handleSetImageFitEvent(e){t.updateImageFit(e.imageFit),this.updateState({imageFit:e.imageFit})}handlePreciseDxfFileParseEvent(e){t.updatePreciseParseDxf(e.isParse),this.updateState({isParseDxfPrecise:e.isParse})}handleSetDxfValueEvent(e){t.updateParseDxfData(e.value),this.updateState({parseDxfData:e.value})}handleSetDebugModeEvent(e){const l=L().LOCAL_MATERIALS;localStorage.removeItem(l),t.updateDebugData(e.debugMode),this.updateState({debugMode:e.debugMode}),window.location.reload()}getAllDebugData(){const e=t.getALLDebugData();this.updateState({debugMode:e})}}export{q as SettingViewModel};
