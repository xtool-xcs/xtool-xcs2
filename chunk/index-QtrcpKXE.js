var We=Object.defineProperty;var Fe=(r,n,e)=>n in r?We(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e;var Se=(r,n,e)=>(Fe(r,typeof n!="symbol"?n+"":n,e),e);import{BaseViewModel as Ge,HOTSPOT_PREFIX as oe,deviceManager as be,useExtCenterStore as ie,deviceService as Ue,HOTSPOT_DEVICE_IP as ce,SingleData as ke,ConnectType as Ce,sensorsTrack as A,ButtonNames as U,PageName as x,EventNames as M,_export_sfc as V,ProductType as G,useViewModel as z,observeState as N,observeEffect as g,isUndefined as qe,xcsApp as Y,__unplugin_components_0 as K,useSystemBack as Re,MultiConnectViewModel as xe,NativeApi as ze}from"./main-f7BGirYr.js";import{useConnectToast as ne,IpViewModel as re,WifiDirectAndroidViewModel as Ke,GetHotspotNameEvent as Ie,GetHotspotListEvent as $e,ConnectDeviceSuccessEvent as Ye,ConnectByIpEvent as pe,ConnectDeviceByHotspotInfoEvent as Je}from"./useconnecttoast-pF_Ib8b4.js";import{WifiViewModel as ue,FindDeviceEvent as _e,ConnectEvent as Xe,CheckIsWifiOpenEvent as je,OpenWifiPageEvent as Qe,OpenSystemPermissionPageEvent as Ze}from"./wifiviewmodel-2Do6mA4t.js";import{useRouter as J,useRoute as Ee}from"./importmap-vue-router-aHGpzyJi.js";import"../assets/index-FfF0Lcw0.js";import{useI18n as se}from"./importmap-vue-i18n-LlhaB8iP.js";import{defineComponent as E,openBlock as l,createElementBlock as v,createVNode as d,unref as p,createBaseVNode as t,toDisplayString as u,withCtx as b,createTextVNode as q,ref as C,computed as O,withDirectives as Te,vShow as De,createCommentVNode as L,Fragment as Z,renderList as ve,createBlock as H,mergeProps as et,normalizeClass as le,normalizeStyle as me,onMounted as ae,onUnmounted as fe,pushScopeId as Pe,popScopeId as Ne,withKeys as tt,watch as ot}from"./importmap-vue-u6Q_1Jji.js";import{Image as he,Button as ee,Space as we,PullRefresh as nt,Tag as ge,Field as st,Popup as Ve,showConfirmDialog as ct,Dialog as it,NavBar as at}from"./importmap-vant-Ij4SMMwJ.js";import"./index-w40geAFS.js";import{PermissionCheck as lt}from"./permissioncheck-Ft6xUpiy.js";import"./apconnectconfig-XbZ4D7sa.js";class dt{}class de{}class Le{}class He{}class rt{}class Oe{}class pt extends Ge{constructor(){super(...arguments);Se(this,"lastConnectedDevice",null)}createState(){return{isOpenLocationPermission:!1,productType:"",hotspotName:"",connectLoadingVisible:!1,isShowSwitchDeviceDialog:!1}}setEventHandler(){this.registerEventHandler(dt,this.grantLocationPermission),this.registerEventHandler(de,this.getHotspotName),this.registerEventHandler(Le,this.connectDevice),this.registerEventHandler(He,this.goToConnect),this.registerEventHandler(rt,this.openMore),this.registerEventHandler(Oe,this.connectDeviceSuccess)}async grantLocationPermission(){const e=window.MeApi.permission;await e.isGrantedLocationPermission()||await e.grantLocationPermission()||e.openAppPermissionPage()}async getHotspotName(){console.log("getHotspotName");const c=await window.MeApi.permission.isGrantedLocationPermission();console.log("getHotspotName isOpenLocationPermission",c),this.updateState({isOpenLocationPermission:c});const s={hotspotName:"",productType:""};if(c){let a=await window.MeApi.wifi.getWifiName();console.log("getHotspotName wifiName",a),a&&oe.test(a)&&(await new Promise(i=>{setTimeout(()=>{i(void 0)},800)}),a=await window.MeApi.wifi.getWifiName(),console.log("getHotspotName wifiName2",a)),a&&oe.test(a)&&(s.hotspotName=a.replace(oe,""),s.productType=this.sliceType(a))}this.updateState(s)}sliceType(e){const s=(oe.exec(e)??[])[1];return console.log("sliceType productType:",s),s}async connectDevice(){var e,c;if(console.log("handleSelect"),be.connected){console.log("handleSelect connected",be.connected);const s=(e=ie().currentData)==null?void 0:e.snCode,a=await((c=Ue)==null?void 0:c.getInfoByIp(ce));if(console.log("===getInfoByIp",a),!a.snCode||a.snCode===s){this.sendEffect({connectDeviceByIp:{ip:ce}});return}ie().closeConnect()}ke.getInstance().connectType=Ce.hotspot,this.sendEffect({connectDeviceByIp:{ip:ce}})}connectDeviceSuccess(){this.recodeHotSpotData()}recodeHotSpotData(){const e=JSON.parse(localStorage.getItem("hotSpotData")??"{}");e.x=(e.x??0)+1,localStorage.setItem("hotSpotData",JSON.stringify(e))}async goToConnect(){var e;A(M.buttonClick,{elementId:U.gotoConnect,pageName:x.hotspot}),(e=window.MeApi)==null||e.permission.openAppPermissionPage()}async openMore(){window.MeApi.openNative.openWebInApp("https://s.xtool.com/Hotspot/more-info")}}const Be=""+new URL("../assets/pic-connect-search-empty-YYttY_eL.png",import.meta.url).href,ut={class:"connect-wrap"},_t={class:"connect-tips"},vt=E({__name:"AndroidEmpty",setup(r){return(n,e)=>{const c=he;return l(),v("div",ut,[d(c,{class:"connect-img",fit:"contain",src:p(Be)},null,8,["src"]),t("div",_t,[t("ul",null,[t("li",null,u(n.$t("mobile.connect.connect_hotspot_step_1")),1),t("li",null,u(n.$t("mobile.connect.connect_hotspot_step_2")),1)])])])}}}),mt=V(vt,[["__scopeId","data-v-bf8f5552"]]),ft={class:"fix_wrap"},ht=E({__name:"BottomButton",props:{isShowAdd:{type:Boolean}},emits:["setting"],setup(r,{emit:n}){const e=n,c=()=>{e("setting")};return(s,a)=>{const i=ee,_=we;return l(),v("div",ft,[d(_,{direction:"vertical",class:"button-wrap"},{default:b(()=>[d(i,{class:"btn",onClick:c},{default:b(()=>[q(u(s.$t("ipad.connect.setting_wifi")),1)]),_:1})]),_:1})])}}}),ye=V(ht,[["__scopeId","data-v-4098ae2e"]]),wt={class:"container_empty"},gt={class:"connect-wrap"},yt={class:"connect-tips"},St={class:"link_tip"},bt=E({__name:"ConnectEmpty",setup(r){const n=J(),e=()=>{window.MeApi.openNative.openWebInApp("https://s.xtool.com/doc/device/not-found-the-device")},c=()=>n.replace({path:"/new-device",query:{active:"WIFI"}});return(s,a)=>{const i=he;return l(),v("div",wt,[t("div",gt,[d(i,{class:"connect-img",fit:"contain",src:p(Be)},null,8,["src"]),t("div",yt,[t("ul",null,[t("li",null,u(s.$t("mobile.connect.connect_device_step_1")),1),t("li",null,u(s.$t("mobile.connect.connect_device_step_2")),1),t("li",null,u(s.$t("mobile.connect.connect_device_step_3")),1)])])]),t("div",St,[t("span",{onClick:e},u(s.$t("mobile.connect.device_not_found")),1)]),d(ye,{"is-show-add":!0,onSetting:c})])}}}),It=V(bt,[["__scopeId","data-v-82959ae4"]]);class $t{static isSupportDevice(n){return[G.D1Pro2,G.D1Pro,G.D1,G.S1,G.F1,G.P1,G.P2,G.M1,G.M2,G.F1Ultra].includes(n)}}const kt={class:"device-wrap-list"},Ct={key:0,class:"connect-tip"},Et={class:"device-list"},Tt={class:"link_tip"},Dt=E({__name:"ConnectDevices",props:{loading:{type:Boolean},list:{},connectSearchShow:{type:Boolean}},setup(r){const n=z(ue),e=C(!1),c=C(!1),{t:s}=se(),{successToastAction:a,showConnectToast:i,failToastAction:_,closeConnectToast:y}=ne(),f=J(),I=O(()=>"container-top-"+(c.value?64:72)),m=C([]);N(()=>n.uiState.wifiDevicesLoading,w=>{console.log("===wifiDevicesLoading",w),setTimeout(()=>{c.value=w},100)}),N(()=>n.uiState.connectIdentityList,w=>{m.value=w}),N(()=>n.uiState.connectLoadingVisible,w=>{w?i():y()});const $=()=>{window.MeApi.openNative.openWebInApp("https://s.xtool.com/doc/device/not-found-the-device")};g(()=>n.uiEffect.connectFail,()=>{_()}),g(()=>n.uiEffect.connectSuccess,()=>{a()});const D=()=>{n.sendEvent(new _e)},P=async w=>{if(!e.value&&!qe(w)){if(!$t.isSupportDevice(w.product)){Y.modal.showToast({msg:s("mobile.toast.device_not_supported")});return}try{e.value=!0,await n.sendEvent(new Xe(w,!0))}catch{}finally{e.value=!1}}},W=()=>{A(M.buttonClick,{elementId:U.configWifi,pageName:x.wifi}),f.replace({path:"/new-device",query:{active:"WIFI"}})};return(w,B)=>{const R=K,h=nt;return l(),v("div",{class:le(["container_wifi",I.value])},[Te(t("section",kt,[d(h,{modelValue:c.value,"onUpdate:modelValue":B[0]||(B[0]=S=>c.value=S),class:"refresh-list","pulling-text":" ","loosing-text":" ",disabled:c.value,onRefresh:D},{loading:b(()=>[d(R,{size:"24px",name:"common-loading",class:"loading-anim f-s-24"})]),default:b(()=>[w.list.length>0?(l(),v("div",Ct,u(w.$t("device.connect.device_list")),1)):L("",!0),t("div",Et,[(l(!0),v(Z,null,ve(w.list,S=>(l(),H(p(At),et({key:S.id,"is-connected":m.value.includes(S.connectIdentity)},S,{onClick:X=>P(S)}),null,16,["is-connected","onClick"]))),128))])]),_:1},8,["modelValue","disabled"])],512),[[De,w.list.length>0]]),t("div",Tt,[t("span",{onClick:$},u(w.$t("mobile.connect.device_not_found")),1)]),d(p(ye),{"is-show-add":!1,onSetting:W})],2)}}}),Pt={class:"device-row"},Nt={class:"right-panel"},Vt={class:"device-info"},Lt={class:"device-name"},Ht={class:"device-ip"},Ot={class:"tag-icon"},Bt=E({__name:"DeviceItem",props:{product:{},name:{},id:{},ip:{},version:{},isConnected:{type:Boolean}},setup(r){const n=e=>e;return(e,c)=>{const s=ge;return l(),v("div",Pt,[d(s,{class:"device-tag",style:me({backgroundColor:e.isConnected?"#28BE44":"#B0B2B5"})},{default:b(()=>[q(u(n(e.product)),1)]),_:1},8,["style"]),t("div",Nt,[t("div",Vt,[t("div",Lt,u(e.name||`xTool_${n(e.product)}`),1),t("div",Ht,u(e.ip),1)]),t("div",Ot,[Te(d(p(K),{class:"f-s-18 success-icon",name:"device_success"},null,512),[[De,e.isConnected]])])])])}}}),At=V(Bt,[["__scopeId","data-v-c66e11f3"]]),Mt=r=>(Pe("data-v-2ed44365"),r=r(),Ne(),r),Wt={class:"container_box"},Ft={key:0},Gt={class:"list_device"},Ut={class:"right-panel"},qt=["onClick"],Rt={class:"device-name"},xt={class:"device-ip"},zt={class:"tag-icon"},Kt={key:1},Yt={class:"tip_btn"},Jt=Mt(()=>t("div",{class:"tip_mid"},null,-1)),Xt=E({__name:"HotspotAndroidItem",setup(r){const n=J(),e=Ee(),{t:c}=se(),s=ie(),a=z(re),i=z(Ke),_=C(!1),y=C(!1),f=O(()=>i.uiState.hotspotList);let I=O(()=>i.uiState.hotspotName);const m=C(!1),{showConnectToast:$,successToastAction:D,failToastAction:P,closeConnectToast:W}=ne();N(()=>i.uiState.isLoadingHotspotList,o=>{console.log("isLoading:---",o),m.value=o}),g(()=>i.uiEffect.showToast,o=>{Y.modal.showToast({msg:c(o.msgKey)})}),g(()=>i.uiEffect.connectSuccess,()=>{D()}),g(()=>i.uiEffect.connectFail,()=>{P()}),g(()=>a.uiEffect.showToast,o=>{Y.modal.showToast({msg:c(o.msgKey)})}),g(()=>a.uiEffect.connectSuccess,()=>{D(),i.sendEvent(new Ye)}),g(()=>a.uiEffect.connectFail,()=>{P()});const w=o=>{n.replace({path:"/set-password",query:{ssid:o.ssid,hasPassword:o.hasPassword,redirect:e.query.redirect?e.query.redirect:""}})};g(()=>i.uiEffect.routeToSetPassword,o=>{w(o)}),g(()=>i.uiEffect.connectDeviceByIp,({ip:o,isShowSwitchDevice:T})=>{a.sendEvent(new pe(o,!0,T))}),N(()=>i.uiState.connectLoadingVisible,o=>{o?$():W()}),N(()=>a.uiState.connectLoadingVisible,o=>{o?$():W()});let B,R;ae(()=>{i.sendEvent(new Ie),i.sendEvent(new $e),B=setInterval(()=>{i.sendEvent(new Ie)},1e3*2),R=setInterval(()=>{i.sendEvent(new $e)},1e3*10)}),fe(()=>{B&&clearInterval(B),R&&clearInterval(R)});const h=o=>o&&o.replace(oe,""),S=async o=>{i.sendEvent(new Je(o))},X=()=>{_.value=!0},te=()=>{y.value=!0};return(o,T)=>{const F=ge;return l(),v(Z,null,[t("div",Wt,[f.value.length>0?(l(),v("div",Ft,[t("div",Gt,[(l(!0),v(Z,null,ve(f.value,k=>(l(),v("div",{key:k.ssid,class:"device-list-wrap"},[d(F,{class:"device-tag",style:me({backgroundColor:p(s).connected&&k.ssid==p(I)?"#28BE44":"#B0B2B5"})},{default:b(()=>[q(u(k.name),1)]),_:2},1032,["style"]),t("div",Ut,[t("div",{class:"device-info",onClick:j=>S(k)},[t("div",Rt,u(h(k.ssid)),1),t("div",xt,u(p(s).connected&&k.ssid==p(I)?o.$t("device.status.connected"):o.$t("mobile.connect.click_here")),1)],8,qt),t("div",zt,[p(s).connected&&k.ssid==p(I)?(l(),H(p(K),{key:0,name:"device_success",size:"18px",class:"f-s-18 connect-icon"})):L("",!0)]),k.hasPassword&&!(p(s).connected&&k.ssid==p(I))?(l(),H(p(K),{key:0,name:"lock",size:"18",class:"f-s-18"})):L("",!0)])]))),128))])])):(l(),v("div",Kt,[d(p(mt))])),t("div",Yt,[t("div",{class:"hot_btn",onClick:te},u(o.$t("mobile.connect.hotspot_connect")),1),Jt,t("div",{class:"hot_btn",onClick:X},u(o.$t("mobile.connect.device_not_found")),1)])]),d(p(Me),{modelValue:_.value,"onUpdate:modelValue":T[0]||(T[0]=k=>_.value=k)},null,8,["modelValue"]),d(p(Ae),{modelValue:y.value,"onUpdate:modelValue":T[1]||(T[1]=k=>y.value=k)},null,8,["modelValue"])],64)}}}),jt=V(Xt,[["__scopeId","data-v-2ed44365"]]),Qt=r=>(Pe("data-v-2f805878"),r=r(),Ne(),r),Zt={class:"list_device"},eo={class:"right-panel"},to={class:"device-info"},oo={class:"device-name"},no={class:"device-ip"},so={class:"tag-icon"},co={key:1,class:"tip-wrap"},io={class:"fix_wrap"},ao={class:"tip_btn"},lo=Qt(()=>t("div",{class:"tip_mid"},null,-1)),ro={class:"button-wrap"},po=E({__name:"HotspotIosItem",setup(r){const{t:n}=se(),e=ie(),c=z(re),s=z(pt);J();const a=O(()=>s.uiState.hotspotName),i=O(()=>s.uiState.productType),_=C(!1),y=C(!1),f=O(()=>!!a.value),{showConnectToast:I,successToastAction:m,failToastAction:$,closeConnectToast:D}=ne();g(()=>s.uiEffect.showToast,h=>{Y.modal.showToast({msg:n(h.msgKey)})}),g(()=>s.uiEffect.connectSuccess,()=>{m()}),g(()=>s.uiEffect.connectFail,()=>{$()}),g(()=>c.uiEffect.showToast,h=>{Y.modal.showToast({msg:n(h.msgKey)})}),g(()=>c.uiEffect.connectSuccess,()=>{m(),s.sendEvent(new Oe)}),g(()=>c.uiEffect.connectFail,()=>{$()}),g(()=>s.uiEffect.connectDeviceByIp,({ip:h})=>{c.sendEvent(new pe(h,!0))}),N(()=>s.uiState.connectLoadingVisible,h=>{h?I():D()}),N(()=>c.uiState.connectLoadingVisible,h=>{h?I():D()});let P;ae(()=>{s.sendEvent(new de),P=setInterval(()=>{s.sendEvent(new de)},3e3)}),fe(()=>{P&&clearInterval(P)});const W=async()=>{s.sendEvent(new Le)},w=()=>{s.sendEvent(new He)},B=()=>{_.value=!0},R=()=>{y.value=!0};return(h,S)=>{const X=ge,te=ee;return l(),v("div",Zt,[f.value?(l(),v("div",{key:0,class:"device-wrap",onClick:S[0]||(S[0]=()=>W())},[d(X,{class:"device-tag",style:me({backgroundColor:p(e).connected?"#28BE44":"#B0B2B5"})},{default:b(()=>[q(u(i.value),1)]),_:1},8,["style"]),t("div",eo,[t("div",to,[t("div",oo,u(a.value),1),t("div",no,u(p(e).connected?h.$t("device.status.connected"):h.$t("mobile.connect.click_here")),1)]),t("div",so,[p(e).connected?(l(),H(p(K),{key:0,size:"18px",class:"f-s-18 connect-icon",name:"device_success"})):L("",!0)])])])):(l(),v("div",co,[t("span",null,u(h.$t("mobile.connect.ios_reason")),1)])),t("div",io,[t("div",ao,[t("div",{class:"hot-btn",onClick:R},u(h.$t("mobile.connect.hotspot_connect")),1),lo,t("div",{class:"hot-btn",onClick:B},u(h.$t("mobile.connect.device_not_found")),1)]),t("div",ro,[d(te,{class:"btn success",onClick:w},{default:b(()=>[q(u(p(e).connected&&p(ce)===p(e).info.ip?h.$t("mobile.connect.switch_devices"):h.$t("mobile.connect.go_connect")),1)]),_:1})])]),d(p(Me),{modelValue:_.value,"onUpdate:modelValue":S[1]||(S[1]=o=>_.value=o)},null,8,["modelValue"]),d(p(Ae),{modelValue:y.value,"onUpdate:modelValue":S[2]||(S[2]=o=>y.value=o)},null,8,["modelValue"])])}}}),uo=V(po,[["__scopeId","data-v-2f805878"]]),_o={class:"connect-wrap"},vo={class:"button-wrap"},mo=E({__name:"IpPanel",setup(r){const{t:n}=se(),e=C(""),c=z(re),s=J(),{showConnectToast:a,successToastAction:i,failToastAction:_,closeConnectToast:y}=ne();g(()=>c.uiEffect.showToast,m=>{Y.modal.showToast({msg:n(m.msgKey)})}),g(()=>c.uiEffect.connectSuccess,()=>{i()}),g(()=>c.uiEffect.connectFail,m=>{_()}),N(()=>c.uiState.connectLoadingVisible,m=>{m?a():y()});const f=async()=>{A(M.buttonClick,{elementId:U.gotoConnect,pageName:x.ip}),ke.getInstance().connectType=Ce.ip,c.sendEvent(new pe(e.value,!0,!1))},I=()=>{A(M.buttonClick,{elementId:U.configWifi,pageName:x.ip}),s.replace({path:"/new-device",query:{active:"IP"}})};return(m,$)=>{const D=st,P=ee;return l(),v("div",_o,[d(D,{modelValue:e.value,"onUpdate:modelValue":$[0]||($[0]=W=>e.value=W),clearable:"",border:!1,class:"edit-wrap",placeholder:m.$t("device.connect.enter_ip_address"),onKeyup:tt(f,["enter"])},null,8,["modelValue","placeholder"]),t("div",vo,[d(P,{block:"",class:"btn border-left mr-12",onClick:I},{default:b(()=>[q(u(m.$t("ipad.connect.setting_wifi")),1)]),_:1}),d(P,{block:"",class:"btn success",disabled:!e.value,onClick:f},{default:b(()=>[q(u(m.$t("component.button.connect")),1)]),_:1},8,["disabled"])])])}}}),fo=V(mo,[["__scopeId","data-v-6e5da617"]]),ho={class:"pop_content"},wo={class:"top_tit"},go={class:"title_tip"},yo=E({__name:"ShowHotspot",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:n}){const e=r,c=n,s=()=>{c("update:modelValue",!1)},a=O(()=>e.modelValue),i=()=>{window.MeApi.openNative.openWebInApp("https://s.xtool.com/Hotspot/more-info")};return(_,y)=>{const f=K,I=ee,m=we,$=Ve;return l(),v("div",ho,[d($,{show:a.value,"onUpdate:show":y[0]||(y[0]=D=>a.value=D),round:"","close-on-click-overlay":!1,class:"pop_modal","overlay-class":"common-popup-filter-overlay"},{default:b(()=>[d(m,{direction:"vertical",class:"pup_content"},{default:b(()=>[d(f,{name:"hotspot-connect",class:"hot-img"}),t("div",wo,u(_.$t("mobile.connect.hotspot_connect")),1),t("div",go,[q(u(_.$t("mobile.connect.connetct_popup"))+" ",1),t("a",{target:"_blank",class:"more_tip",onClick:i},u(_.$t("device.common.learn_more")),1),d(f,{name:"arrow-right-up",class:"up-icon f-s-16",size:"16px"})]),d(I,{class:"btn",onClick:s},{default:b(()=>[q(u(_.$t("component.button.iknow")),1)]),_:1})]),_:1})]),_:1},8,["show"])])}}}),Ae=V(yo,[["__scopeId","data-v-530fd5f1"]]),So={class:"pop_content"},bo={class:"top_tit"},Io={class:"title_tip"},$o=E({__name:"ShowPop",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:n}){const e=r,c=n,s=()=>{A(M.buttonClick,{elementId:U.targetGotIt}),c("update:modelValue",!1)},a=O(()=>e.modelValue);return(i,_)=>{const y=ee,f=we,I=Ve;return l(),v("div",So,[d(I,{show:a.value,"onUpdate:show":_[0]||(_[0]=m=>a.value=m),round:"","close-on-click-overlay":!1,class:"pop_modal","overlay-class":"common-popup-filter-overlay"},{default:b(()=>[d(f,{direction:"vertical",class:"pup_content"},{default:b(()=>[d(p(K),{name:"hotspot-hand",class:"hot-img"}),t("div",bo,u(i.$t("mobile.connect.device_not_found")),1),t("div",Io,u(i.$t("mobile.connect.not_hotspot")),1),d(y,{class:"btn",onClick:s},{default:b(()=>[q(u(i.$t("component.button.iknow")),1)]),_:1})]),_:1})]),_:1},8,["show"])])}}}),Me=V($o,[["__scopeId","data-v-85ecfa3e"]]),ko=""+new URL("../assets/pic-connect-searching-LhOww42n.png",import.meta.url).href,Co={class:"container_empty"},Eo={class:"connect-wrap"},To={class:"bold-tip"},Do={class:"connect-tip"},Po={class:"link_tip"},No=E({__name:"ConnectSearch",setup(r){const n=J(),e=()=>{A(M.buttonClick,{elementId:U.deviceNotFound,pageName:x.connectDevice}),window.MeApi.openNative.openWebInApp("https://s.xtool.com/doc/device/not-found-the-device")},c=()=>{A(M.buttonClick,{elementId:U.configWifi,pageName:x.connectDevice}),n.replace({path:"/new-device",query:{active:"WIFI"}})};return(s,a)=>{const i=he;return l(),v("div",Co,[t("div",Eo,[d(i,{class:"connect-img",fit:"contain",src:p(ko)},null,8,["src"]),t("div",To,u(s.$t("mobile.connect.make_sure_is_same_wifi")),1),t("div",Do,u(s.$t("mobile.connect.find_device_in_the_same_wifi")),1)]),t("div",Po,[t("span",{onClick:e},u(s.$t("mobile.connect.device_not_found")),1)]),d(ye,{"is-show-add":!0,onSetting:c})])}}}),Vo=V(No,[["__scopeId","data-v-148c6bed"]]),Lo=t("div",null,null,-1),Ho=E({__name:"ConnectStatus",setup(r){const{t:n}=se(),e=z(ue);e.sendEvent(new je);const c=O(()=>!e.uiState.wifiDevicesLoading&&e.uiState.wifiDeviceList.length===0?1:0),s=O(()=>{var f;return i.value&&((f=a.value)==null?void 0:f.length)===0});ae(()=>{e.sendEvent(new _e)});const a=C(),i=C(!1),_=O(()=>e.uiState.isWifiOpen);N(()=>e.uiState.wifiDeviceList,f=>{a.value=f,console.log("wifiDeviceList.value:",a.value)}),N(()=>e.uiState.wifiDevicesLoading,f=>{i.value=f}),g(()=>e.uiEffect.showOpenWifiDialog,()=>{console.log("viewModel.uiEffect.showOpenWifiDialog:",e.uiEffect.showOpenWifiDialog),ct({title:n("mobile.connect.not_open_wifi"),message:n("mobile.connect.not_open_wifi_tip"),confirmButtonText:n("mobile.common.go_to_setting"),cancelButtonText:n("mobile.common.not_yet")}).then(()=>{A(M.buttonClick,{elementId:U.gotoSetting,pageName:x.connectDevice}),e.sendEvent(new Qe)}).catch(()=>{A(M.buttonClick,{elementId:U.notYet,pageName:x.connectDevice})})});const y=()=>{Y.modal.showTipModal({title:n("mobile.common.local_network_title"),content:n("mobile.common.local_network_tip"),haveIcon:!0,iconName:"msg_info",confirmTxt:n("mobile.common.go_to_setting"),cancelTxt:n("mobile.common.cancel"),onConfirm:()=>{e.sendEvent(new Ze)}})};return g(()=>e.uiEffect.showGrantNetPermissionDialog,()=>{y()}),(f,I)=>{var m;return l(),v(Z,null,[Lo,c.value===0&&_.value?(l(),H(p(Dt),{key:0,list:a.value,loading:i.value,"connect-search-show":s.value},null,8,["list","loading","connect-search-show"])):L("",!0),!_.value||((m=a.value)==null?void 0:m.length)===0&&!i.value?(l(),H(p(It),{key:1})):L("",!0),s.value&&_.value?(l(),H(Vo,{key:2})):L("",!0)],64)}}}),Oo=E({__name:"ConnectTipDialog",props:{close:{type:Function},isShow:{type:Boolean}},setup(r){const n=r,e=()=>{n.close()};return(c,s)=>{const a=it;return l(),H(a,{show:c.isShow,title:c.$t("common.dialog.tips"),"close-on-click-overlay":!0,"confirm-button-text":c.$t("common.dialog.ok"),message:c.$t("mobile.connect.connetct_popup"),onConfirm:e},null,8,["show","title","confirm-button-text","message"])}}}),Bo=E({__name:"DeviceAndroid",setup(r){return(n,e)=>(l(),v("div",null,[d(p(jt))]))}}),Ao=V(Bo,[["__scopeId","data-v-ce780e0f"]]),Mo=E({__name:"DeviceIos",setup(r){return(n,e)=>(l(),v("div",null,[d(p(uo))]))}}),Wo=V(Mo,[["__scopeId","data-v-aee13626"]]),Fo=E({__name:"IpConnect",setup(r){return(n,e)=>(l(),v("div",null,[d(p(fo))]))}}),Go={class:"connect-content"},Uo=["onClick"],qo={key:0,class:"gps-top"},Ro={key:1},xo={key:0},zo={key:1},Ko=E({__name:"Index",setup(r){const n=z(xe),e=z(ue),c=Ee(),s=J(),{closeRereshToast:a}=ne();Re(()=>(s.back(),!0));const i=C("WIFI"),_=C(!1),y=C(!1),f=C(0),I=C(!1),m=C(!1);let $;const D=o=>{if(A(M.buttonClick,{elementId:o,pageName:x.connectDevice}),console.log("当前tab",o),i.value=o,o==="HOTSPOT"){console.log("当前:",o);const T=localStorage.getItem("showPopoover"),F=JSON.parse(T)+1;console.log("storedNumber:",F),o==="HOTSPOT"&&F===1&&(m.value=!0),localStorage.setItem("showPopoover",F)}else m.value=!1},P=()=>{const o=navigator.userAgent;I.value=!!o.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)},W=O(()=>n.uiState.currentData),w=()=>{var o;(o=W.value)!=null&&o.connected?s.replace({path:"/device-setting",query:c.query}):s.back()},B=()=>{S.value=!0,e.sendEvent(new _e)},R=[{key:"WIFI",name:"Wi-Fi"},{key:"HOTSPOT",name:"Hotspot"},{key:"IP",name:"IP"}],h=async()=>{await X()?_.value=!1:(f.value=0,_.value=!0)};ot(()=>i.value,o=>{o==="HOTSPOT"&&($&&clearInterval($),$=setInterval(()=>{h()},1e3))});let S=C(!1);N(()=>e.uiState.wifiDevicesLoading,o=>{y.value=o,o||(S.value=!1)}),N(()=>e.uiState.isWifiOpen,o=>{o||(S.value=!1)});const X=async()=>{const o=window.MeApi.permission,T=await o.isLocationOpen(),F=await o.isGrantedLocationPermission(),k=await ze.isIphone();let j=!1;return k?j=await o.isAccuracyLocationOpen():j=!0,!!(T&&F&&j)};ae(async()=>{c.query.active&&(console.log("router.query.active:",c.query.active),i.value=String(c.query.active)),P()}),fe(()=>{a(),$&&clearInterval($)});const te=()=>{A(M.buttonClick,{elementId:U.hotspotGotIt}),m.value=!1};return(o,T)=>{const F=K,k=ee,j=at;return l(),v("div",null,[d(j,{fixed:"",title:o.$t("component.button.select_device"),style:{position:"fixed"}},{left:b(()=>[d(k,{class:"header-lft-btn",size:"small",onClick:w},{default:b(()=>[d(F,{name:"arrow_left",color:"#fff",class:"f-s-22"})]),_:1})]),right:b(()=>[d(k,{class:"header-lft-btn",disabled:y.value,size:"small"},{default:b(()=>[i.value==="WIFI"?(l(),H(F,{key:0,name:"refresh-list",class:le(["f-s-22 touch-active",p(S)?"loading-anim":""]),onClick:B},null,8,["class"])):L("",!0)]),_:1},8,["disabled"])]),_:1},8,["title"]),t("div",Go,[(l(),v(Z,null,ve(R,Q=>t("div",{key:Q.key,class:"connect-box"},[t("div",{class:le(["connect-item",{active:i.value===Q.key}]),onClick:Yo=>D(Q.key)},u(Q.name),11,Uo)])),64))]),d(p(Oo),{"is-show":m.value,close:()=>te()},null,8,["is-show","close"]),i.value==="WIFI"?(l(),H(p(Ho),{key:0})):L("",!0),i.value==="HOTSPOT"?(l(),v(Z,{key:1},[_.value?(l(),v("div",qo,[_.value?(l(),H(lt,{key:0,modelValue:f.value,"onUpdate:modelValue":T[0]||(T[0]=Q=>f.value=Q),"is-show-config-wifi":!0},null,8,["modelValue"])):L("",!0)])):(l(),v("div",Ro,[I.value?(l(),v("div",xo,[d(p(Wo))])):(l(),v("div",zo,[d(p(Ao))]))]))],64)):L("",!0),i.value==="IP"?(l(),H(p(Fo),{key:2})):L("",!0)])}}}),ln=V(Ko,[["__scopeId","data-v-4eb20c99"]]);export{ln as default};
