import{useViewModel as P,observeEffect as B,useSystemBack as M,sensorsTrack as p,ButtonNames as v,EventNames as f,useExtCenterStore as T,xcsApp as F,router as w,__unplugin_components_0 as L,_export_sfc as N}from"./main-f7BGirYr.js";import{BaseViewState as z,useViewState as q}from"./useviewstate-4zKfOP-K.js";import{ref as i,defineComponent as D,computed as U,onMounted as $,reactive as H,resolveComponent as K,openBlock as h,createElementBlock as y,createVNode as _,withCtx as E,Fragment as g,renderList as O,createBlock as R,normalizeClass as G}from"./importmap-vue-u6Q_1Jji.js";import"../assets/index-FfF0Lcw0.js";import{ImportFileViewModel as J,ImportFileEvent as k}from"./importfileviewmodel-n9UVAPSW.js";import{useI18n as Q}from"./importmap-vue-i18n-LlhaB8iP.js";import{useRoute as W}from"./importmap-vue-router-aHGpzyJi.js";import{ProjectSheet as X}from"./projectsheet-K9koNuPr.js";import{Tabbar as Y,TabbarItem as Z}from"./importmap-vant-Ij4SMMwJ.js";function ee(r){for(var c=-1,l=r==null?0:r.length,n=0,a=[];++c<l;){var u=r[c];u&&(a[n++]=u)}return a}class te extends z{createState(){return{mainActiveIndex:i(0)}}}const oe=D({__name:"Index",setup(r){const c=q(te),{t:l}=Q(),n=i(c.state.mainActiveIndex.value),a=i(0),u=W(),I=U(()=>{const e=u.query["stack-key"];return[{id:0,inactiveIcon:"tab_home_default",activeIcon:"tab_home_selected",path:`/main/home?stack-key=${e}`},{id:1,inactiveIcon:"tab_new_common",activeIcon:"tab_new_common"},{id:2,inactiveIcon:"tab_projects_default",activeIcon:"tab_projects_selected",path:`/main/projects?stack-key=${e}`}]});$(()=>{a.value=n.value});const C=H([{key:"new",name:l("mobile.common.add_project"),icon:"add"},{key:"open",name:l("mobile.editor.my_system_file"),icon:"file"},{key:"add",name:l("mobile.editor.open_photo_album"),icon:"picture"},{key:"take",name:l("mobile.common.photo"),icon:"camera"}]),b=i(!1),S=e=>{console.log("changeTab="+e),e===0?p(f.buttonClick,{elementId:v.home}):e===1?p(f.addProjectClick,{elementId:v.addProject}):e===2&&p(f.buttonClick,{elementId:v.localFiles}),e!=1&&(c.state.mainActiveIndex.value=e,a.value=e),e==I.value[1].id&&(b.value=!0)},m=P(J);B(()=>m.uiEffect.importSuccess,e=>{e.filePath&&w.push({path:"/editor",query:{filePath:e.filePath}})});const x=(e,t)=>{if(n.value=a.value,!T().ext){F.modal.showSelectDeviceDialog();return}switch(t){case 0:p(f.addProjectClick,{elementId:v.newProject}),w.push("/editor");break;case 1:m.sendEvent(new k(4));break;case 2:m.sendEvent(new k(1));break;case 3:m.sendEvent(new k(0));break}},j=()=>{n.value=a.value};return M(()=>{const e=Array.from(document.getElementsByClassName("project-card--overlay")),t=i([""]);return e.length&&e.forEach(s=>{var d;s instanceof HTMLElement&&(t.value.push(((d=s.style)==null?void 0:d.display)===""?"block":""),s.style.display===""&&s.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})))}),t.value=ee(t.value),!!t.value.length}),(e,t)=>{const s=K("router-view"),d=L,A=Z,V=Y;return h(),y(g,null,[_(s),_(V,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value=o),fixed:"",placeholder:"","safe-area-inset-bottom":"",border:!1,onChange:S},{default:E(()=>[(h(!0),y(g,null,O(I.value,o=>(h(),R(A,{key:o.path,to:o.path,replace:!0},{icon:E(()=>[_(d,{name:n.value==o.id?o.activeIcon:o.inactiveIcon,size:o.id==1?"48px":"28px",class:G([o.id==1?"f-s-48":"f-s-28"])},null,8,["name","size","class"])]),_:2},1032,["to"]))),128))]),_:1},8,["modelValue"]),_(X,{value:b.value,"onUpdate:value":t[1]||(t[1]=o=>b.value=o),"action-list":C,onSelect:x,onOnCancel:j},null,8,["value","action-list"])],64)}}}),de=N(oe,[["__scopeId","data-v-bb142b6f"]]);export{de as default};
