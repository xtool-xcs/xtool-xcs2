import{__unplugin_components_0 as j,_export_sfc as V,useViewModel as J,sensorsTrack as M,ButtonNames as U,EventNames as A,router as Ne,ProductType as Z,XCSActivityStateListener as ie,checkIsIphone as ke,observeState as be,remoteDeviceConfigKey as De,defaultRemoteDeviceConfig as Pe,PageName as se,xcsApp as ae,useSystemBack as Te}from"./main-f7BGirYr.js";import{useRoute as ue,useRouter as ve}from"./importmap-vue-router-aHGpzyJi.js";import{useI18n as z}from"./importmap-vue-i18n-LlhaB8iP.js";import{defineComponent as x,openBlock as s,createElementBlock as p,createBaseVNode as c,Fragment as _e,renderList as pe,normalizeClass as F,createVNode as m,toDisplayString as h,pushScopeId as ye,popScopeId as xe,ref as f,computed as q,onMounted as fe,withCtx as k,createTextVNode as K,createCommentVNode as N,unref as n,createBlock as D,watch as B,onBeforeUnmount as We,onUnmounted as Ve,resolveDynamicComponent as $e,KeepAlive as Le,normalizeStyle as Re}from"./importmap-vue-u6Q_1Jji.js";import{WifiConfigViewModel as ne,ConfigWifiEvent as Oe,GrantedPhoneInputWifiPermissionsEvent as Fe,GetWifiNameEvent as me,PermissionCheck as Me}from"./permissioncheck-Ft6xUpiy.js";import"../assets/index-FfF0Lcw0.js";import{CONNECT_STATUS as u,PERMISSION_STATUS as y,deviceConfig as G}from"./apconnectconfig-XbZ4D7sa.js";import{BaseViewState as Ue,useViewState as H}from"./useviewstate-4zKfOP-K.js";import{Button as Q,NoticeBar as Ae,Image as oe,showDialog as le,Field as Be,Checkbox as Ie,NavBar as Ge}from"./importmap-vant-Ij4SMMwJ.js";import{WifiViewModel as we,OpenWifiPageEvent as he,CheckIsWifiOpenEvent as qe}from"./wifiviewmodel-2Do6mA4t.js";const Ke=""+new URL("../assets/pic-device-connect-fail-_WaLPcdJ.png",import.meta.url).href,ze=""+new URL("../assets/pic-device-connect-transfer-GN3B9GR1.png",import.meta.url).href,Je=""+new URL("../assets/pic-device-connect-wifi-v3ZonlSo.png",import.meta.url).href,Xe=C=>(ye("data-v-983a871c"),C=C(),xe(),C),Ye={class:"steps"},Ze=Xe(()=>c("i",{class:"step-line-inner"},null,-1)),je=[Ze],He={key:0,class:"step-img"},Qe={key:0},et={key:1,class:"step-img"},tt={class:"finish-tip"},nt={class:"step-icon-text"},ot=x({__name:"Step",props:{active:{default:1},isError:{type:Boolean,default:!1},stepList:{}},setup(C){const e=C;return(i,w)=>{const r=j;return s(),p("div",null,[c("div",Ye,[(s(!0),p(_e,null,pe(e.stepList,(t,a)=>(s(),p("div",{key:a,class:"step"},[c("div",{class:F(["step-head",e.active==t.stepIndex||t.stepIndex<=e.active?"step-finish":"step-wait"])},[c("div",{class:F(["step-line",e.active===t.stepIndex+1||t.stepIndex+1<=e.active?"step-finish":"step-wait"])},je,2),e.active==t.stepIndex?(s(),p("div",He,[e.isError?(s(),p("div",Qe,[m(r,{name:"msg_error",class:"f-s-20"})])):(s(),p("div",{key:1,class:F(["progress-tip",`progress-tip-${t.stepIndex}`])},[m(r,{name:"ap-loading",class:"f-s-16 loading-anim"})],2))])):t.stepIndex+1<=e.active?(s(),p("div",et,[c("div",tt,[m(r,{class:"check-icon f-s-20",name:"device-checked"})])])):(s(),p("div",{key:2,class:F(["step-icon",{active:e.active+1===t.stepIndex}])},[c("div",nt,h(t.stepIndex),1)],2))],2),c("div",{class:F(["step-main",e.active==t.stepIndex||t.stepIndex<=e.active?"step-finish":"step-wait"])},[c("div",{class:F(["step-title",[{active:e.active+1===t.stepIndex},`step-title-${t.stepIndex}`]])},h(t.title),3)],2)]))),128))])])}}}),ct=V(ot,[["__scopeId","data-v-983a871c"]]);class ee extends Ue{createState(){const e=f(u.SELECT_DEVICE),i=f(!0),w=f(""),r=f("");return{status:e,wifiName:w,wifiPwd:r,isTranfer:i}}}const it={class:"connect-wrap"},st={class:"connect-tips"},at={class:"connect-card"},lt=["src"],rt={key:0,class:"connect-finish-btn-wrap"},dt=x({__name:"DeviceConnectWifi",props:{device:{}},emits:["finish"],setup(C,{emit:e}){const i=ue(),w=ve(),{t:r}=z(),t=C,a=e,I=f(1),l=J(ne),S=H(ee),_=f(!1),v=q(()=>_.value?Ke:I.value===1?ze:Je),P=[{stepIndex:1,title:r("mobile.connect.send_info_to_device")},{stepIndex:2,title:r("mobile.connect.connect_wifi")}],$=()=>{var d;(d=l.sendEvent(new Oe(S.state.wifiName.value,S.state.wifiPwd.value,t.device.id)))==null||d.then(g=>{console.log("==>ap result ",g),g?(I.value=2,_.value=!1,setTimeout(()=>{a("finish")},5e3)):_.value=!0})};fe(()=>{$()});const o=()=>{M(A.buttonClick,{elementId:U.retry}),_.value=!1,I.value=1,$()},L=()=>{M(A.buttonClick,{elementId:U.cancel}),w.replace({path:"/connect-device",query:i.query})};return(d,g)=>{const W=Q;return s(),p("div",it,[c("div",st,h(d.$t("mobile.connect.connect_mobile_tip")),1),c("div",at,[c("img",{class:"connect-img",src:v.value},null,8,lt),m(ct,{class:"connect-step",active:I.value,"is-error":_.value,"step-list":P},null,8,["active","is-error"])]),_.value?(s(),p("div",rt,[m(W,{block:"",type:"default",class:"btn-cancel",onClick:L},{default:k(()=>[K(h(d.$t("device.firmware.cancel")),1)]),_:1}),m(W,{block:"",class:"retry-btn",onClick:o},{default:k(()=>[K(h(d.$t("device.firmware.retry")),1)]),_:1})])):N("",!0)])}}}),ut=V(dt,[["__scopeId","data-v-ce12cd10"]]),vt={class:"connect-finish-wrap"},_t={class:"connect-card"},pt=["src"],ft={class:"title"},mt={class:"connect-finish-btn-wrap"},It=x({__name:"DeviceConnectWifiFinish",props:{device:{}},setup(C){const{t:e}=z(),i=()=>{M(A.buttonClick,{elementId:U.complete}),Ne.replace({path:"connect-device"})};return(w,r)=>{const t=Q;return s(),p("div",vt,[c("div",_t,[c("img",{class:"device-img",src:w.device.noticeImg},null,8,pt),c("p",ft,h(n(e)("ipad.connect.device_connected")),1),c("p",null,h(n(e)("ipad.connect.connected_notice")),1)]),c("div",mt,[m(t,{block:"",class:"ok-btn",onClick:i},{default:k(()=>[K(h(w.$t("ipad.connect.go_to_connect")),1)]),_:1})])])}}}),wt=V(It,[["__scopeId","data-v-ccbc911e"]]),ht={class:"connect-wrap"},gt={class:"connect-card"},Et={key:0,class:"connect-tip"},Ct={key:1,class:"connect-tip"},St=x({__name:"DeviceStepTip",props:{device:{}},setup(C){const{t:e}=z(),i=C,w=q(()=>[Z.D1,Z.D1Pro,Z.M1].includes(i.device.id));return f(),e(i.device.preNotice,{color:e(i.device.preLightColor)}),e("ipad.connect.idle_notice",{color:e(i.device.preLightColor)}),(r,t)=>{const a=Ae,I=oe;return s(),p("div",ht,[w.value?(s(),D(a,{key:0,wrapable:"",scrollable:!1,text:r.$t("mobile.connect.d_connect_notice")},null,8,["text"])):N("",!0),c("div",gt,[m(I,{class:"connect-img",fit:"contain",src:r.device.powerImg},null,8,["src"]),r.device.id==="F1Ultra"?(s(),p("div",Et,h(n(e)("ipad.connect.reset_notice_gs002")),1)):(s(),p("div",Ct,h(n(e)(i.device.preNotice,{color:n(e)(i.device.preLightColor)})),1))])])}}}),Nt=V(St,[["__scopeId","data-v-2dbf258a"]]),kt={class:"input-wifi-wrap"},bt={class:"wifi-wrap"},Dt={class:"connect-wifi-tip"},Pt={class:"tip-title"},Tt={class:"tip-label"},yt={class:"input-wrap"},xt={class:"name-input"},Wt={class:"right-lock"},Vt={class:"right-lock"},$t={class:"check-box"},Lt={class:"psw-text"},re="ls_is_save_pw",te="wifi_pw",de="INPUT_WIFI_LISTENER_KEY",Rt=x({__name:"InputWifi",setup(C,{expose:e}){const i=J(ne),w=J(we),r=H(ee),{t}=z(),a=f(y.PERMISSION_DEFAULT),I=f(!1),l=f(""),S=f(""),_=f(!1);let v;B(()=>a.value,()=>{console.log("==>Per permissionStatus.value",a.value),a.value===y.PERMISSION_MANUAL_INPUT?(l.value="",clearInterval(v)):a.value===y.PERMISSION_GRANTED?(console.log("==>ap 扫描wifi granted"),o(),v&&clearInterval(v),v=setInterval(()=>{o()},1e3)):o()}),B(()=>l.value,d=>{console.log("==>ap wifiName.value",l.value),S.value=$(l.value)??"",r.state.wifiName.value=d,console.log("==>ap ConfigState.state.wifiname",r.state.wifiName)}),B(()=>S.value,d=>{console.log("==>ap wifiPwd.value",d),r.state.wifiPwd.value=d,console.log("==>ap ConfigState.state.wifiPwd",r.state.wifiPwd)}),B(()=>I.value,()=>{const d=I.value?"1":"0";localStorage.setItem(re,d)});const P=()=>{w.sendEvent(new he)};fe(()=>{console.log("==>ap inputWifi onMounted"),o(),I.value=localStorage.getItem(re)==="1",ie.add(de,()=>o())});const $=d=>d===""?"":localStorage.getItem(te+d)??"";We(()=>{I.value?localStorage.setItem(te+l.value,S.value):localStorage.setItem(te+l.value,"")}),Ve(()=>{ie.remove(de),clearInterval(v)});async function o(){if(console.log("==>queryWifi permissionStatus.value",a.value),a.value!==y.PERMISSION_MANUAL_INPUT)try{const d=await ke();if(await i.sendEvent(new Fe(d)),console.log("==>queryWif ",i.uiState.isGrantedInputWifiPermission),i.uiState.isGrantedInputWifiPermission)a.value=y.PERMISSION_GRANTED;else{a.value=y.PERMISSION_NO_GRANTED;return}i.sendEvent(new me)}catch(d){console.log("==>ap input querywifi error",d)}}return be(()=>i.uiState.wifiName,d=>{a.value!==y.PERMISSION_MANUAL_INPUT&&(l.value=d)}),e({canNext:()=>{let d=l.value,g=S.value;return d===""?(le({message:t("mobile.connect.wifi_name_error")}),!1):g===""||g.length<8?(le({message:t("mobile.connect.wifi_pwd_error")}),!1):!0}}),(d,g)=>{const W=j,X=Be,Y=Ie;return s(),p("div",kt,[c("div",bt,[c("div",Dt,[c("div",Pt,h(n(t)("mobile.connect.connect_wifi_tip")),1),c("div",Tt,h(n(t)("mobile.connect.wifi_support_tip")),1)]),c("div",yt,[c("div",xt,[m(X,{modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=T=>l.value=T),label:n(t)("mobile.connect.wifi_name"),clearable:"",maxlength:"50",readonly:a.value==n(y).PERMISSION_GRANTED,placeholder:n(t)("device.common.wifi_name"),class:"input-box",border:!1,onClickRightIcon:P},{"right-icon":k(()=>[c("div",Wt,[m(W,{name:a.value==n(y).PERMISSION_GRANTED?"psw-arrow_right":"",class:"f-s-18"},null,8,["name"])])]),_:1},8,["modelValue","label","readonly","placeholder"]),m(X,{modelValue:S.value,"onUpdate:modelValue":g[1]||(g[1]=T=>S.value=T),clearable:"",class:"input-box",maxlength:"50",border:!1,label:n(t)("mobile.connect.wifi_password"),type:_.value?"text":"password",placeholder:n(t)("mobile.connect.placeholder_password"),onClickRightIcon:g[2]||(g[2]=T=>_.value=!_.value)},{"right-icon":k(()=>[c("div",Vt,[m(W,{name:_.value?"eye-on":"eye-off",class:"f-s-18"},null,8,["name"])])]),_:1},8,["modelValue","label","type","placeholder"])]),m(Y,{modelValue:I.value,"onUpdate:modelValue":g[3]||(g[3]=T=>I.value=T),class:"check-psw"},{icon:k(()=>[c("div",$t,[m(W,{class:"check-icon",name:I.value?"device-checked":"psw-no"},null,8,["name"])])]),default:k(()=>[c("div",Lt,h(n(t)("mobile.connect.remember_password")),1)]),_:1},8,["modelValue"])])]),a.value===n(y).PERMISSION_NO_GRANTED?(s(),D(Me,{key:0,modelValue:a.value,"onUpdate:modelValue":g[4]||(g[4]=T=>a.value=T),class:"permission-check"},null,8,["modelValue"])):N("",!0)])}}}),Ot=V(Rt,[["__scopeId","data-v-1062f4e0"]]),Ft=""+new URL("../assets/pic-connect-ZFiPrXoe.png",import.meta.url).href,Mt={class:"connect-wrap"},Ut={class:"connect-tip"},At={key:0},Bt=x({__name:"PhoneConnectDeviceWifi",props:{device:{}},setup(C){const{t:e}=z();return(i,w)=>{const r=oe;return s(),p("div",Mt,[m(r,{class:"connect-img",fit:"contain",src:n(Ft)},null,8,["src"]),c("div",Ut,[c("ul",null,[c("li",null,[K(h(n(e)("mobile.connect.mobile_connect_xtool_hot_spot_new",{device:i.device.deviceWifi}))+" ",1),i.device.id==="M1"?(s(),p("span",At," ,"+h(n(e)("mobile.connect.connect_wifi_pwd")),1)):N("",!0)]),c("li",null,h(n(e)("mobile.connect.back_to_app")),1)])])])}}}),Gt=V(Bt,[["__scopeId","data-v-6b5d5082"]]),qt={class:"content-list"},Kt=["onClick"],zt={class:"device-name"},Jt=x({__name:"SelectNewDevice",emits:["updateSelectedDevice","updateSelectedDeviceImg"],setup(C,{emit:e}){const i=f(""),w=e,r=l=>{i.value=l,w("updateSelectedDevice",G.get(l).id),w("updateSelectedDeviceImg",G.get(l).powerImg)};let t=JSON.parse(localStorage.getItem(De)||"[]");t.length===0&&(t=Pe),console.log("local remoteDeviceConfig",t);const a=f(t),I=q(()=>{let l=[...G.keys()];const S=a.value.filter(_=>[Z.P1].includes(_.code)||_.status!=="enabled"?!1:l.includes(_.code));return console.log("devices:",S),S.map(_=>_.code)});return(l,S)=>{const _=oe;return s(),p("div",qt,[(s(!0),p(_e,null,pe(I.value,v=>(s(),p("div",{key:v,class:F(["content-card",{"device-selected":v===i.value}]),onClick:P=>r(v)},[m(_,{class:"device-pic",fit:"contain",src:n(G).get(v).devicePic},null,8,["src"]),c("span",zt,h(n(G).get(v).name),1)],10,Kt))),128))])}}}),Xt={class:"new-device-wrap"},Yt={class:"new-panel"},Zt={class:"check-box"},jt={class:"text-right"},Ht=x({__name:"NewDeviceConnect",setup(C,{expose:e}){const{t:i}=z(),w=f(),r=f(),t=q(()=>a.value),a=f(""),I=f(""),l=H(ee),S=l.state.wifiName;l.state.isTranfer;const _=l.state.wifiPwd,v=f(),P=J(we),$=J(ne);B(()=>a.value,(E,b)=>{E.length>0&&E!==b?v.value=G.get(E):v.value=void 0});const o=f(u.SELECT_DEVICE),L=f(!1),d=E=>{console.log("deviceName:",E),t.value=!0,a.value=E},g=E=>{t.value=!0,I.value=E},W=q(()=>o.value===u.SELECT_DEVICE?i("device.common.next_step"):i("ipad.connect.confirm_next"));B(()=>o.value,()=>{l.state.status=o.value,o.value===5||o.value===6?l.state.isTranfer.value=!1:l.state.isTranfer.value=!0});const X=(E,b)=>E.split("_")[0]===b.split("_")[0]&&E.split("_")[1]===b.split("_")[1],Y=async()=>{var E,b;if(console.log("==>ap onNextStep ",o.value),o.value===u.SELECT_DEVICE)M(A.buttonClick,{elementId:U.next,pageName:se.selectDevice});else if(o.value===u.RESET)M(A.buttonClick,{elementId:U.addDeviceNext,pageName:se.resetDevice});else if(o.value===u.SELECT_WIFI)M(A.buttonClick,{elementId:U.addDeviceConfirm});else if(o.value===u.CONNECT_DEVICE_WIFI){if(!await Ee()){console.log("==>no permission");return}M(A.buttonClick,{elementId:U.hotspotNext})}if(o.value===u.SELECT_WIFI){if(!w.value.canNext())return}else if(o.value===u.CONNECT_DEVICE_WIFI){await P.sendEvent(new qe),await $.sendEvent(new me);const R=$.uiState.wifiName;if(console.log("==>CONNECT_DEVICE_WIFI ",R,v.value),!P.uiState.isWifiOpen){ae.modal.showToast({msg:i("mobile.connect.not_open_wifi"),wordBreak:"break-word",icon:"error"});return}if((E=v.value)!=null&&E.deviceWifi&&R&&!X((b=v.value)==null?void 0:b.deviceWifi,R)){ae.modal.showToast({msg:i("mobile.connect.connect_xtool_hot_spot_error"),icon:"error",wordBreak:"break-word"});return}}o.value++,console.log("addStep.value:",o.value)},T=()=>{Y()},ge=()=>o.value<=u.SELECT_DEVICE||o.value===u.DONE||o.value===u.DEVICE_CONNECT_WIFI_STEP?!1:(o.value--,!0),Ee=async()=>{const E=window.MeApi.permission;return!await E.isGrantedLocationPermission()&&!await E.grantLocationPermission()?(E.openAppPermissionPage(),!1):!0};e({canBack:ge});const Ce=()=>{P.sendEvent(new he)};return(E,b)=>{const R=j,Se=Ie,ce=Q;return s(),p("div",Xt,[c("div",Yt,[(s(),D(Le,null,[o.value==n(u).SELECT_DEVICE?(s(),D($e(Jt),{key:0,onUpdateSelectedDevice:d,onUpdateSelectedDeviceImg:g},null,32)):N("",!0)],1024)),o.value==n(u).RESET?(s(),D(Nt,{key:0,device:v.value},null,8,["device"])):N("",!0),o.value==n(u).SELECT_WIFI?(s(),D(Ot,{key:1,ref:O=>{O&&(w.value=O)}},null,512)):N("",!0),o.value==n(u).CONNECT_DEVICE_WIFI?(s(),D(Gt,{key:2,ref:O=>{O&&(r.value=O)},device:v.value},null,8,["device"])):N("",!0),o.value==n(u).DEVICE_CONNECT_WIFI_STEP?(s(),D(ut,{key:3,device:v.value,onFinish:T},null,8,["device"])):N("",!0),o.value==n(u).DONE?(s(),D(wt,{key:4,device:v.value},null,8,["device"])):N("",!0)]),[n(u).DEVICE_CONNECT_WIFI_STEP,n(u).DONE].includes(o.value)?N("",!0):(s(),p("div",{key:0,class:"next-button",style:Re({"flex-direction":o.value==n(u).CONNECT_DEVICE_WIFI?"row":"column"})},[o.value==n(u).RESET?(s(),D(Se,{key:0,modelValue:L.value,"onUpdate:modelValue":b[0]||(b[0]=O=>L.value=O),class:"next-check"},{icon:k(()=>[c("div",Zt,[m(R,{class:"check-icon",name:L.value?"device-checked":"device-check"},null,8,["name"])])]),default:k(()=>[c("div",jt,h(n(i)("mobile.connect.device-connect-tip")),1)]),_:1},8,["modelValue"])):N("",!0),o.value==n(u).CONNECT_DEVICE_WIFI?(s(),D(ce,{key:1,block:"",class:"btn-set-wifi",onClick:Ce},{default:k(()=>[K(h(n(i)("mobile.connect.setting_wifi_ap")),1)]),_:1})):N("",!0),m(ce,{class:"next-btn",disabled:!t.value||o.value===n(u).SELECT_DEVICE&&!a.value||o.value==n(u).RESET&&!L.value||o.value==n(u).SELECT_WIFI&&(n(S)===""||n(_).length<8),block:"",onClick:Y},{default:k(()=>[K(h(W.value),1)]),_:1},8,["disabled"])],4))])}}}),Qt=V(Ht,[["__scopeId","data-v-99ce95d2"]]),en=x({__name:"Index",setup(C){const e=H(ee),i=ve(),w=ue(),r=f(),t=q(()=>e.state.isTranfer.value),a=f("arrow_left");B(()=>e.state.isTranfer.value,l=>{l?a.value="arrow_left":a.value="ap-close"},{immediate:!0}),Te(()=>(t.value&&I(),!0));const I=()=>{r.value.canBack()||i.replace({path:"/connect-device",query:w.query})};return(l,S)=>{const _=j,v=Q,P=Ge;return s(),p("div",null,[m(P,{title:l.$t("mobile.connect.add_new_device"),fixed:""},{left:k(()=>[m(v,{class:"header-lft-btn",size:"small",onClick:I},{default:k(()=>[m(_,{name:a.value,color:"#fff",class:"f-s-22"},null,8,["name"])]),_:1})]),_:1},8,["title"]),m(n(Qt),{ref_key:"newDeviceConnect",ref:r},null,512)])}}}),vn=V(en,[["__scopeId","data-v-73af9bc1"]]);export{vn as default};
