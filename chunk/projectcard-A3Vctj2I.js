import{projectManager as I,BaseViewModel as R,__unplugin_components_0 as p,_export_sfc as M}from"./main-f7BGirYr.js";import{defineComponent as U,computed as d,ref as O,openBlock as o,createElementBlock as c,createBaseVNode as a,createBlock as b,unref as l,createCommentVNode as A,normalizeClass as E,createVNode as h,toDisplayString as i,withModifiers as z,withDirectives as W,withCtx as L,normalizeStyle as Q}from"./importmap-vue-u6Q_1Jji.js";import{useI18n as D}from"./importmap-vue-i18n-LlhaB8iP.js";import{Image as Z,ActionSheet as J}from"./importmap-vant-Ij4SMMwJ.js";class G{constructor(t=!0){this.isNeedShowLoading=t}}class ${constructor(t,e){this.fileId=t,this.newName=e}}class ee{constructor(t){this.fileId=t}}class te{constructor(t){this.fileId=t}}class se{constructor(t){this.fileId=t}}class ae{constructor(t){this.index=t}}class re{async getAllXcsFiles(){var t;return(t=window.MeApi)==null?void 0:t.fileHelper.getAllXcsFile()}async openProject(t){return I.openProject({file:t.path,fileId:t.fileId,fileName:t.name})}async isHaveChangeProject(){return I.isHaveChangeProject()}async renameProject(t,e){var r,g;return(g=(r=window.MeApi)==null?void 0:r.fileHelper)==null?void 0:g.renameXCS(e,t)}async deleteProject(t){var e,r;return(r=(e=window.MeApi)==null?void 0:e.fileHelper)==null?void 0:r.deleteXCS(t)}async shareProject(t){var e,r;return(r=(e=window.MeApi)==null?void 0:e.fileHelper)==null?void 0:r.shareXCS(t)}async copyProject(t){var e,r;return(r=(e=window.MeApi)==null?void 0:e.fileHelper)==null?void 0:r.copyXCS(t)}}const f=new re;class Ke extends R{createState(){return{projectList:[],showLoading:!1,projectName:"",operationLoading:!1,topTabbarIndex:0}}setEventHandler(){this.registerEventHandler(G,this.getAllXcsProjectList),this.registerEventHandler($,this.renameProjectEvent),this.registerEventHandler(ee,this.deleteProjectEvent),this.registerEventHandler(te,this.shareProjectEvent),this.registerEventHandler(se,this.copyProjectEvent),this.registerEventHandler(ae,this.setTopTabbarIndexEvent)}async getAllXcsProjectList(t){const{isNeedShowLoading:e}=t;try{e&&this.updateState({showLoading:!0}),await this.refreshProjectList()}catch(r){console.log("getAllXcsProjectList error ====>",r)}finally{this.updateState({showLoading:!1})}}async renameProjectEvent(t){try{this.updateState({operationLoading:!0});const{fileId:e,newName:r}=t;await f.renameProject(r,e),await this.refreshProjectList(),this.updateState({operationLoading:!1}),this.sendEffect({renameProjectResult:{isSuccess:!0}})}catch(e){console.log("renameProjectEvent error ====>",e),this.updateState({operationLoading:!1})}}async shareProjectEvent(t){try{const{fileId:e}=t,r=await f.shareProject(e);this.sendEffect({shareProjectResult:{isSuccess:r}})}catch(e){this.sendEffect({shareProjectResult:{isSuccess:!1,msg:`文件分享失败 ====>${e}`}})}}async deleteProjectEvent(t){try{const{fileId:e}=t;this.updateState({operationLoading:!0}),await f.deleteProject(e),await this.refreshProjectList(),this.updateState({operationLoading:!1}),this.sendEffect({deleteProjectResult:{isSuccess:!0}})}catch(e){console.log("deleteProjectEvent error ====>",e),this.updateState({operationLoading:!1}),this.sendEffect({deleteProjectResult:{isSuccess:!1}})}}async copyProjectEvent(t){try{const{fileId:e}=t;this.updateState({operationLoading:!0}),await f.copyProject(e),await this.refreshProjectList(),this.updateState({operationLoading:!1})}catch(e){console.log("copyProjectEvent error ====>",e),this.updateState({operationLoading:!1})}}setTopTabbarIndexEvent(t){this.updateState({topTabbarIndex:t.index})}async refreshProjectList(){try{const t=await f.getAllXcsFiles();this.updateState({projectList:t})}catch(t){console.log("refreshProjectList error ====>",t)}}}const k="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAYAAACLz2ctAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAUfSURBVHgB7dzNbuJWGMbxF0iiLLkEsht1RfMhZVeQMt1Fba5g0ivozBXEuYJhrmCSK5iZbdMqLCOFILoZRd2EXZZlGSkB932JiYwDxoCNbfX/k4BwsDmReHR8PmyLAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJilYE87Ozvv9KWhj/KU7Xqu6zba7fapADNEyFNXH87Nzc150StwQjY25UKh4FSr1bBtgBFHwvNUkeeAypqvQFqt1sStDw8P5f7+Xrwv7QkQrmJP0/K0u7trL8OAFgVI0do8G5dKpTs9vgsQF1pApGquFrDf7291Op2uACH0KOlG3ZYWEKkatYA2si3baHcSbwQ82g6YZZgnb7Q7TdeehgHUSeZTnef76AvaK/r5qR5+CSBm0jx90LyciDcdM0GvWCwOFzUKoxKbZN7c3BzOzTw+Pt7Z6/r6+pa9Pjw89AgfFjXqE+rKRyH42csgxAtYz9thWHZ1ddUVIEEMQpAqAohUEUCkigAiVXOthEzz5uLA0Sif+Mt0uNMr9Av17z9fdEL3vTw4kcHw9J3xfYtP9e/15su+29vbxzq0/yzxOdNR2W9hG3h12rltVQk/vWjEBnEdnYY439jYaM47iEuyPv1ux5saGbKpt3a77UjKYmkBb9/+6WiIxk5W1XF32S25lz/88bY6bb+o4Vu1vb29qs4E3HmBr0m0MIi3Xc3206msS/2OX6PstOr6siS2Q/C8Icxy+AaDwaVMn0SNqqKPL9ryvJcM1Zc1sfYBw0L45rJWGZVlNXz7+/sVDcMXid4CzWQrTLokVVtlfRZqyYlY+oB+FkLtE4q/T+i6hW+39WbX/l40fNpfOdOXs2mfT+gjzuzjBelhzJHXLdEnXRFqROnP6WpSZW1t7Vj7V2P9Ye99c1X1aag/6ktdciCRUfBYS+gWzm8PLo7tz6y2fD6/+N/Y+reG+H3UwYSdqtZqtRwNRDD4tWAr6F1f8y6p+iyckgOJTcNYCAeue5SX8OkPVpPxQ+Hwx5UFeK1101+mrVLwsBh8H2t9utifiwFJovOA/xz89dVec9Dy2Q9WCRT9LUvQVulboKiy4vpi61cmKfGJ6Enhe/G4Lhn2r6zWsvXlInBBiQYwLHxR5glXSVukbqBoqUOY9udqgaJuwvX9FCjKxelziQVw2mHX/z5LIXx6erKugP//K+vI+kQW4N0ZYGxAo33AZoL1/S7PE9j++r5KDiQSwLA+3yIrJqtg50NqP+qTv8zuBqE/7mcdoET632zk6YXoLPA9HTOhvvOY6msEPmrm5eKx2OcBIww4Oq/mCa3/8hzCmWvHSdJWo1Eqlaz1qviKj7XseJnrobW1O5pSn+PVV46zvn6/P3P+09aFtY6FWlwT11pyrC1g1NHuomvHSbNWSftmFpbY+k/etTTdkPrqMdf3IU+XzsYWwHmnWrIawuvr6462ID9KYNCwAAvV0ay5vQTqa0iOxBLARef5MtwSdnVFYstbYWhK9BbKtmtaq2cX8et3RBoILFufXYU2T32ZZ1cxzXN1OxAmLE+cEY1UEUCkigAiVQQQqSKASBV3yUfsuEs+0uYId8lHiir2xF3ykXncJR+pogVEqrhLPmLHXfKRG9wlH0ngLvlIz9J3yQ/iLvkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4n/sP/jHlOew69qwAAAAASUVORK5CYII=",ie="data:image/svg+xml,%3csvg%20width='28'%20height='28'%20viewBox='0%200%2028%2028'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M18.5%2010.5C18.5%209.30653%2018.0259%208.16193%2017.182%207.31802C16.3381%206.47411%2015.1935%206%2014%206C12.8065%206%2011.6619%206.47411%2010.818%207.31802C9.97411%208.16193%209.5%209.30653%209.5%2010.5C9.5%2011.6935%209.97411%2012.8381%2010.818%2013.682C11.6619%2014.5259%2012.8065%2015%2014%2015C15.1935%2015%2016.3381%2014.5259%2017.182%2013.682C18.0259%2012.8381%2018.5%2011.6935%2018.5%2010.5ZM14%2016.125C9.39762%2016.125%205%2017.3029%205%2019.0005C5%2020.7004%208.375%2024%2014%2024C19.625%2024%2023%2020.7004%2023%2019.0005C23%2017.3018%2018.6024%2016.125%2014%2016.125Z'%20fill='white'/%3e%3c/svg%3e",oe={class:"case-hot"},ce={class:"card-item-head rowBC"},ne={class:"pay-case-item"},le={key:0,class:"pay-case-item"},de={key:1,class:"pay-case-item"},Ae={key:1,class:"card-item-tag"},he={class:"operate-icon"},pe={class:"card-item-box"},ue={key:0,class:"card-item-thumb"},me={key:2,class:"discount-content"},ve={key:0,class:"flex"},fe={class:"discount-price"},ge={class:"regular—price"},we={key:1,class:"flex"},ye={class:"discount-price"},Pe={class:"card-item-bottom"},Se={key:0},je={class:"card-item-name"},Ce={class:"text-ellipsis-line"},Ee={class:"card-item-info rowSC"},Le=["src"],ke={class:"card-item-avatar"},_e={class:"text-ellipsis-line"},Ie={class:"upvote-num"},be={key:1},ze={class:"card-item-info rowBC"},Xe={class:"card-item-name"},Te={class:"text-ellipsis-line"},Be={key:0,class:"card-item-size"},He={class:"card-item-desc"},Ye={class:"text-ellipsis-line time-txt"},Ne=U({name:"ProjectCard",__name:"ProjectCard",props:{actionList:{},cardType:{},data:{},progress:{},moreDisable:{type:Boolean}},emits:["selectSheet","cardItemClick","likeAction"],setup(n,{emit:t}){const e=n,r=t,{t:g}=D(),X={async mounted(s,u){var P,v;const m=u.value;if(m==="projectImg"){s.src=k;return}try{const S=await((v=(P=window.MeApi)==null?void 0:P.fileHelper)==null?void 0:v.read2Str(m));s.src=S||k}catch{s.src=k}}},T=d(()=>{if(B(e.data))return e.data.isShowProgress;const s=e.progress;return s&&s>0&&s<100});function B(s){return s.isShowProgress!==void 0}const H=d(()=>e.data.hasOwnProperty("fileSize")),j=O(!1),Y=(s,u)=>{r("selectSheet",s)},N=()=>{r("likeAction",e.data)},x=()=>{r("cardItemClick",e.data)},q=()=>{e.moreDisable||(j.value=!0)},V=()=>{e.cardType===1&&r("cardItemClick",e.data)},F=s=>{if(s.hasDiscount)return"recommand-home-percent";if(s.sellTag==="Best Seller")return"recommand-home-king";if(s.sellTag==="Exclusive")return"recommand-home-check";if(s.sellTag==="New")return"recommand-home-news"},_=d(()=>"forSale"in e.data&&e.data.forSale),w=d(()=>"sellTag"in e.data&&e.data.sellTag),y=d(()=>"hasDiscount"in e.data&&e.data.hasDiscount),C=d(()=>"discount"in e.data&&e.data.discount),K=d(()=>y.value?"percent-active":w.value==="New"?"new-active":"exclusive-active");return(s,u)=>{var v;const m=Z,P=J;return o(),c("div",null,[a("div",oe,[y.value&&!w.value?(o(),b(l(p),{key:0,name:"recommand-home-fire",class:"f-s-20 fire-top",size:"20px"})):A("",!0)]),a("div",{class:E(["card-item",`card-item-type${s.cardType}`]),onClick:V},[a("div",ce,[s.cardType===2&&_.value?(o(),c("div",{key:0,class:E(["pay-case",K.value])},[a("span",ne,[h(l(p),{name:F(s.data),size:"16px",class:"f-s-16"},null,8,["name"])]),y.value?(o(),c("span",le,i(C.value.discountPercent)+i("% OFF"),1)):A("",!0),!y.value&&w.value?(o(),c("span",de,i((v=w.value)==null?void 0:v.toUpperCase()),1)):A("",!0)],2)):s.data.fileType?(o(),c("div",Ae,i(s.data.fileType),1)):A("",!0),a("div",{class:E(["card-item-operate",{"no-type-operate":!s.data.fileType}]),onClick:z(q,["stop"])},[a("div",he,[h(l(p),{name:s.moreDisable?"more-gray":"more",size:"20px",class:"f-s-20"},null,8,["name"])])],2)]),a("div",pe,[s.cardType===1?W((o(),c("img",ue,null,512)),[[X,s.data.fileImg]]):(o(),b(m,{key:1,src:s.data.fileImg,fit:"contain",class:"card-item-thumb",onClick:z(x,["stop"])},{error:L(()=>[h(l(p),{name:"image-error",size:"100px",class:"f-s-100"})]),_:1},8,["src"])),_.value?(o(),c("div",me,[h(l(p),{name:"recommand-price-fire",class:"f-s-20 price-fire-icon",size:"20px"}),C.value.disPrice?(o(),c("div",ve,[a("span",fe,i("$")+i(C.value.disPrice),1),a("span",ge,i("$")+i(s.data.origPrice),1)])):(o(),c("div",we,[a("span",ye,i("$")+i(s.data.origPrice),1)]))])):A("",!0)]),a("div",Pe,[s.cardType===2?(o(),c("div",Se,[a("div",je,[a("div",Ce,i(s.data.fileName),1)]),a("div",Ee,[h(m,{round:"",width:"14px",height:"14px",fit:"contain",style:{"margin-right":"6px"},src:s.data.fileAvatar},{loading:L(()=>[]),error:L(()=>[a("img",{src:l(ie),width:"100%",alt:""},null,8,Le)]),_:1},8,["src"]),a("div",ke,[a("div",_e,i(s.data.createdByName),1)]),a("div",{class:"card-item-upvote",onClick:N},[h(l(p),{name:s.data.isLike?"recommand-upvote":"recommand-un-upvote",size:"12px",class:"f-s-12"},null,8,["name"]),a("span",Ie,i(s.data.likeNum),1)])])])):(o(),c("div",be,[a("div",ze,[a("div",Xe,[a("div",Te,i(s.data.fileName),1)]),H.value?(o(),c("div",Be,i(s.data.fileSize),1)):A("",!0)]),a("div",He,[a("div",Ye,i(s.data.fileText),1)])]))]),T.value?(o(),c("div",{key:0,class:"card-progress",style:Q({width:`${s.progress}%`})},null,4)):A("",!0)],2),h(P,{show:j.value,"onUpdate:show":u[0]||(u[0]=S=>j.value=S),teleport:"body","overlay-class":"project-card--overlay",class:"project-card-sheet",closeable:!1,title:s.data.fileName,actions:s.actionList,"cancel-text":l(g)("mobile.common.cancel"),"close-on-click-action":"",onSelect:Y},null,8,["show","title","actions","cancel-text"])])}}}),Re=M(Ne,[["__scopeId","data-v-9635b748"]]);export{se as CopyProjectEvent,ee as DeleteProjectEvent,Ke as LocalProjectViewModel,Re as ProjectCard,$ as RenameProjectEvent,G as RequestProjectListEvent,ae as SetTopTabbarIndexEvent,te as ShareProjectEvent};
