var f=Object.defineProperty;var g=(r,t,e)=>t in r?f(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var a=(r,t,e)=>(g(r,typeof t!="symbol"?t+"":t,e),e),c=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var o=(r,t,e)=>(c(r,t,"read from private field"),e?e.call(r):t.get(r)),p=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},d=(r,t,e,i)=>(c(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e);import{merge as u,Container as A,Ticker as E,TRANSFORMER_EVENT as T,Matrix as v,createDisplay as M,DISPLAY_TYPE as R}from"./main-f7BGirYr.js";import"../assets/index-FfF0Lcw0.js";import"./importmap-vue-u6Q_1Jji.js";import"./importmap-vue-router-aHGpzyJi.js";import"./importmap-vue-i18n-LlhaB8iP.js";import"./importmap-vant-Ij4SMMwJ.js";const m={color:44321,alpha:.2},P={mode:"timer"};var n;class C{constructor(t,e){a(this,"container");a(this,"graphicsMap",new Map);p(this,n,void 0);a(this,"options");d(this,n,t),this.options=u(P,e),this.container=new A,this.container.name="HitAreaDisplays",this.initEvents(),console.log(`[ DebugPainter ] run in "${this.options.mode}" mode`),this.options.mode==="timer"&&this.listenTicker()}get viewport(){return o(this,n).viewport}get transformer(){return o(this,n).transformer}listenTicker(){E.system.add(()=>{this.updateAll()})}initEvents(){this.transformer.on(T.TRANSFORM_CHANGE,()=>{this.transformer.selected.forEach(e=>{this.handleAddOrUpdate(e)})});const t=o(this,n).events;o(this,n).on(t.ADD_HIT_AREA,e=>{this.handleAddOrUpdate(e)}),o(this,n).on(t.UPDATE_HIT_AREA,e=>{this.handleAddOrUpdate(e)}),o(this,n).on(t.REMOVE_HIT_AREA,e=>{this.handleRemove(e)})}handleAddOrUpdate(t){if(!(t!=null&&t.hitArea))return;const e=t.hitArea;this.graphicsMap.has(e)?this.update(e,t):this.add(e,t)}handleRemove(t){if(!(t!=null&&t.hitArea))return;const e=t.hitArea;this.graphicsMap.has(e)&&this.remove(e)}setTransformBy(t,e){let i=e;const s=new v;s.prepend(i.localTransform),this.container.parent!==i.parent&&(i=i.parent,s.prepend(i.localTransform)),t.transform.setFromMatrix(s)}add(t,e){const i=w();l(i,t),this.setTransformBy(i,e),this.container.addChild(i),this.graphicsMap.set(t,{display:e,graphics:i})}update(t,e){const{graphics:i}=this.graphicsMap.get(t);l(i,t),this.setTransformBy(i,e)}remove(t){const{graphics:e}=this.graphicsMap.get(t);this.container.removeChild(e),this.graphicsMap.delete(t)}updateAll(){for(const[t,{display:e}]of this.graphicsMap.entries())this.update(t,e)}}n=new WeakMap;function w(){const r=M(R.PATH);return r.interactive=!1,r.interactiveChildren=!1,r}function l(r,t,e="evenodd"){var h;t==null||t.toSVGString;const i=((h=t.toSVGString)==null?void 0:h.call(t))??"";r.clear(),r.beginFill(m.color,m.alpha);const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",i),s.setAttribute("fill-rule",e),r.embedPath(s),r.endFill()}export{C as HitAreaDebugPainter};
