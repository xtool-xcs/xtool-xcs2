(function(){"use strict";var yt=typeof global=="object"&&global&&global.Object===Object&&global,bt=typeof self=="object"&&self&&self.Object===Object&&self,vt=yt||bt||Function("return this")(),v=vt.Symbol,F=Object.prototype,mt=F.hasOwnProperty,wt=F.toString,m=v?v.toStringTag:void 0;function St(t){var n=mt.call(t,m),e=t[m];try{t[m]=void 0;var r=!0}catch{}var o=wt.call(t);return r&&(n?t[m]=e:delete t[m]),o}var gt=Object.prototype,xt=gt.toString;function _t(t){return xt.call(t)}var Et="[object Null]",Tt="[object Undefined]",V=v?v.toStringTag:void 0;function jt(t){return t==null?t===void 0?Tt:Et:V&&V in Object(t)?St(t):_t(t)}function Ot(t){return t!=null&&typeof t=="object"}var It="[object Symbol]";function At(t){return typeof t=="symbol"||Ot(t)&&jt(t)==It}function Ut(t,n){for(var e=-1,r=t==null?0:t.length,o=Array(r);++e<r;)o[e]=n(t[e],e,t);return o}var Rt=Array.isArray,Ct=1/0,H=v?v.prototype:void 0,W=H?H.toString:void 0;function S(t){if(typeof t=="string")return t;if(Rt(t))return Ut(t,S)+"";if(At(t))return W?W.call(t):"";var n=t+"";return n=="0"&&1/t==-Ct?"-0":n}var kt=/\s/;function Pt(t){for(var n=t.length;n--&&kt.test(t.charAt(n)););return n}var $t=/^\s+/;function Mt(t){return t&&t.slice(0,Pt(t)+1).replace($t,"")}function Dt(t,n,e,r){for(var o=t.length,i=e+(r?1:-1);r?i--:++i<o;)if(n(t[i],i,t))return i;return-1}function Ft(t){return t!==t}function Vt(t,n,e){for(var r=e-1,o=t.length;++r<o;)if(t[r]===n)return r;return-1}function Y(t,n,e){return n===n?Vt(t,n,e):Dt(t,Ft,e)}function q(t){return t==null?"":S(t)}function Ht(t,n,e){var r=-1,o=t.length;n<0&&(n=-n>o?0:o+n),e=e>o?o:e,e<0&&(e+=o),o=n>e?0:e-n>>>0,n>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+n];return i}function B(t,n,e){var r=t.length;return e=e===void 0?r:e,!n&&e>=r?t:Ht(t,n,e)}var Wt="\\ud800-\\udfff",Yt="\\u0300-\\u036f",qt="\\ufe20-\\ufe2f",Bt="\\u20d0-\\u20ff",Gt=Yt+qt+Bt,Jt="\\ufe0e\\ufe0f",Lt="\\u200d",Xt=RegExp("["+Lt+Wt+Gt+Jt+"]");function Zt(t){return Xt.test(t)}function zt(t){return t.split("")}var G="\\ud800-\\udfff",Kt="\\u0300-\\u036f",Qt="\\ufe20-\\ufe2f",Nt="\\u20d0-\\u20ff",te=Kt+Qt+Nt,ee="\\ufe0e\\ufe0f",ne="["+G+"]",I="["+te+"]",A="\\ud83c[\\udffb-\\udfff]",re="(?:"+I+"|"+A+")",J="[^"+G+"]",L="(?:\\ud83c[\\udde6-\\uddff]){2}",X="[\\ud800-\\udbff][\\udc00-\\udfff]",oe="\\u200d",Z=re+"?",z="["+ee+"]?",ie="(?:"+oe+"(?:"+[J,L,X].join("|")+")"+z+Z+")*",se=z+Z+ie,ce="(?:"+[J+I+"?",I,L,X,ne].join("|")+")",ue=RegExp(A+"(?="+A+")|"+ce+se,"g");function ae(t){return t.match(ue)||[]}function g(t){return Zt(t)?ae(t):zt(t)}function fe(t,n){for(var e=t.length;e--&&Y(n,t[e],0)>-1;);return e}function K(t,n){for(var e=-1,r=t.length;++e<r&&Y(n,t[e],0)>-1;);return e}function le(t,n,e){if(t=q(t),t&&(e||n===void 0))return Mt(t);if(!t||!(n=S(n)))return t;var r=g(t),o=g(n),i=K(r,o),s=fe(r,o)+1;return B(r,i,s).join("")}var de=/^\s+/;function pe(t,n,e){if(t=q(t),t&&(e||n===void 0))return t.replace(de,"");if(!t||!(n=S(n)))return t;var r=g(t),o=K(r,g(n));return B(r,o).join("")}var U=function(t,n){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])},U(t,n)};function x(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");U(t,n);function e(){this.constructor=t}t.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}function R(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function C(t,n){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var r=e.call(t),o,i=[],s;try{for(;(n===void 0||n-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(u){s={error:u}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return i}function k(t,n,e){if(e||arguments.length===2)for(var r=0,o=n.length,i;r<o;r++)(i||!(r in n))&&(i||(i=Array.prototype.slice.call(n,0,r)),i[r]=n[r]);return t.concat(i||Array.prototype.slice.call(n))}typeof SuppressedError=="function"&&SuppressedError;function b(t){return typeof t=="function"}function Q(t){var n=function(r){Error.call(r),r.stack=new Error().stack},e=t(n);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var P=Q(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(r,o){return o+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function $(t,n){if(t){var e=t.indexOf(n);0<=e&&t.splice(e,1)}}var _=function(){function t(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var n,e,r,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var u=R(s),f=u.next();!f.done;f=u.next()){var a=f.value;a.remove(this)}}catch(h){n={error:h}}finally{try{f&&!f.done&&(e=u.return)&&e.call(u)}finally{if(n)throw n.error}}else s.remove(this);var c=this.initialTeardown;if(b(c))try{c()}catch(h){i=h instanceof P?h.errors:[h]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var O=R(l),w=O.next();!w.done;w=O.next()){var Ge=w.value;try{et(Ge)}catch(h){i=i??[],h instanceof P?i=k(k([],C(i)),C(h.errors)):i.push(h)}}}catch(h){r={error:h}}finally{try{w&&!w.done&&(o=O.return)&&o.call(O)}finally{if(r)throw r.error}}}if(i)throw new P(i)}},t.prototype.add=function(n){var e;if(n&&n!==this)if(this.closed)et(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}},t.prototype._hasParent=function(n){var e=this._parentage;return e===n||Array.isArray(e)&&e.includes(n)},t.prototype._addParent=function(n){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n},t.prototype._removeParent=function(n){var e=this._parentage;e===n?this._parentage=null:Array.isArray(e)&&$(e,n)},t.prototype.remove=function(n){var e=this._finalizers;e&&$(e,n),n instanceof t&&n._removeParent(this)},t.EMPTY=function(){var n=new t;return n.closed=!0,n}(),t}(),N=_.EMPTY;function tt(t){return t instanceof _||t&&"closed"in t&&b(t.remove)&&b(t.add)&&b(t.unsubscribe)}function et(t){b(t)?t():t.unsubscribe()}var nt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},rt={setTimeout:function(t,n){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];return setTimeout.apply(void 0,k([t,n],C(e)))},clearTimeout:function(t){var n=rt.delegate;return((n==null?void 0:n.clearTimeout)||clearTimeout)(t)},delegate:void 0};function he(t){rt.setTimeout(function(){throw t})}function ot(){}function E(t){t()}var it=function(t){x(n,t);function n(e){var r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,tt(e)&&e.add(r)):r.destination=me,r}return n.create=function(e,r,o){return new D(e,r,o)},n.prototype.next=function(e){this.isStopped||this._next(e)},n.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},n.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(e){this.destination.next(e)},n.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n}(_),ye=Function.prototype.bind;function M(t,n){return ye.call(t,n)}var be=function(){function t(n){this.partialObserver=n}return t.prototype.next=function(n){var e=this.partialObserver;if(e.next)try{e.next(n)}catch(r){T(r)}},t.prototype.error=function(n){var e=this.partialObserver;if(e.error)try{e.error(n)}catch(r){T(r)}else T(n)},t.prototype.complete=function(){var n=this.partialObserver;if(n.complete)try{n.complete()}catch(e){T(e)}},t}(),D=function(t){x(n,t);function n(e,r,o){var i=t.call(this)||this,s;if(b(e)||!e)s={next:e??void 0,error:r??void 0,complete:o??void 0};else{var u;i&&nt.useDeprecatedNextContext?(u=Object.create(e),u.unsubscribe=function(){return i.unsubscribe()},s={next:e.next&&M(e.next,u),error:e.error&&M(e.error,u),complete:e.complete&&M(e.complete,u)}):s=e}return i.destination=new be(s),i}return n}(it);function T(t){he(t)}function ve(t){throw t}var me={closed:!0,next:ot,error:ve,complete:ot},we=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Se(t){return t}function ge(t){return t.length===0?Se:t.length===1?t[0]:function(e){return t.reduce(function(r,o){return o(r)},e)}}var st=function(){function t(n){n&&(this._subscribe=n)}return t.prototype.lift=function(n){var e=new t;return e.source=this,e.operator=n,e},t.prototype.subscribe=function(n,e,r){var o=this,i=_e(n)?n:new D(n,e,r);return E(function(){var s=o,u=s.operator,f=s.source;i.add(u?u.call(i,f):f?o._subscribe(i):o._trySubscribe(i))}),i},t.prototype._trySubscribe=function(n){try{return this._subscribe(n)}catch(e){n.error(e)}},t.prototype.forEach=function(n,e){var r=this;return e=ct(e),new e(function(o,i){var s=new D({next:function(u){try{n(u)}catch(f){i(f),s.unsubscribe()}},error:i,complete:o});r.subscribe(s)})},t.prototype._subscribe=function(n){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(n)},t.prototype[we]=function(){return this},t.prototype.pipe=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return ge(n)(this)},t.prototype.toPromise=function(n){var e=this;return n=ct(n),new n(function(r,o){var i;e.subscribe(function(s){return i=s},function(s){return o(s)},function(){return r(i)})})},t.create=function(n){return new t(n)},t}();function ct(t){var n;return(n=t??nt.Promise)!==null&&n!==void 0?n:Promise}function xe(t){return t&&b(t.next)&&b(t.error)&&b(t.complete)}function _e(t){return t&&t instanceof it||xe(t)&&tt(t)}var Ee=Q(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ut=function(t){x(n,t);function n(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return n.prototype.lift=function(e){var r=new at(this,this);return r.operator=e,r},n.prototype._throwIfClosed=function(){if(this.closed)throw new Ee},n.prototype.next=function(e){var r=this;E(function(){var o,i;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=R(r.currentObservers),u=s.next();!u.done;u=s.next()){var f=u.value;f.next(e)}}catch(a){o={error:a}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}})},n.prototype.error=function(e){var r=this;E(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=e;for(var o=r.observers;o.length;)o.shift().error(e)}})},n.prototype.complete=function(){var e=this;E(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var r=e.observers;r.length;)r.shift().complete()}})},n.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(n.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),n.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},n.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},n.prototype._innerSubscribe=function(e){var r=this,o=this,i=o.hasError,s=o.isStopped,u=o.observers;return i||s?N:(this.currentObservers=null,u.push(e),new _(function(){r.currentObservers=null,$(u,e)}))},n.prototype._checkFinalizedStatuses=function(e){var r=this,o=r.hasError,i=r.thrownError,s=r.isStopped;o?e.error(i):s&&e.complete()},n.prototype.asObservable=function(){var e=new st;return e.source=this,e},n.create=function(e,r){return new at(e,r)},n}(st),at=function(t){x(n,t);function n(e,r){var o=t.call(this)||this;return o.destination=e,o.source=r,o}return n.prototype.next=function(e){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.next)===null||o===void 0||o.call(r,e)},n.prototype.error=function(e){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.error)===null||o===void 0||o.call(r,e)},n.prototype.complete=function(){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||r===void 0||r.call(e)},n.prototype._subscribe=function(e){var r,o;return(o=(r=this.source)===null||r===void 0?void 0:r.subscribe(e))!==null&&o!==void 0?o:N},n}(ut);let ft=60*1e3;var lt=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function u(c){try{a(r.next(c))}catch(l){s(l)}}function f(c){try{a(r.throw(c))}catch(l){s(l)}}function a(c){c.done?i(c.value):o(c.value).then(u,f)}a((r=r.apply(t,n||[])).next())})};function Te(t=ft){return new Promise(n=>setTimeout(n,t))}function je(t,n=ft,e=new Ie("function did not complete within allowed time")){return lt(this,void 0,void 0,function*(){const r=Symbol("DELAY_EXPIRED"),o=yield Promise.race([t(),Oe(n,r)]);if(o===r)throw e;return o})}const Oe=(t,n)=>lt(void 0,void 0,void 0,function*(){return yield Te(t),n});class Ie extends Error{constructor(){super(...arguments),this.isTimeout=!0}}let j;const Ae=new Uint8Array(16);function Ue(){if(!j&&(j=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!j))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return j(Ae)}var Re=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ce(t){return typeof t=="string"&&Re.test(t)}const d=[];for(let t=0;t<256;++t)d.push((t+256).toString(16).slice(1));function ke(t,n=0){return d[t[n+0]]+d[t[n+1]]+d[t[n+2]]+d[t[n+3]]+"-"+d[t[n+4]]+d[t[n+5]]+"-"+d[t[n+6]]+d[t[n+7]]+"-"+d[t[n+8]]+d[t[n+9]]+"-"+d[t[n+10]]+d[t[n+11]]+d[t[n+12]]+d[t[n+13]]+d[t[n+14]]+d[t[n+15]]}function Pe(t){if(!Ce(t))throw TypeError("Invalid UUID");let n;const e=new Uint8Array(16);return e[0]=(n=parseInt(t.slice(0,8),16))>>>24,e[1]=n>>>16&255,e[2]=n>>>8&255,e[3]=n&255,e[4]=(n=parseInt(t.slice(9,13),16))>>>8,e[5]=n&255,e[6]=(n=parseInt(t.slice(14,18),16))>>>8,e[7]=n&255,e[8]=(n=parseInt(t.slice(19,23),16))>>>8,e[9]=n&255,e[10]=(n=parseInt(t.slice(24,36),16))/1099511627776&255,e[11]=n/4294967296&255,e[12]=n>>>24&255,e[13]=n>>>16&255,e[14]=n>>>8&255,e[15]=n&255,e}var dt={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function $e(t,n,e){if(dt.randomUUID&&!n&&!t)return dt.randomUUID();t=t||{};const r=t.random||(t.rng||Ue)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){e=e||0;for(let o=0;o<16;++o)n[e+o]=r[o];return n}return ke(r)}const pt=t=>{typeof t=="function"&&t()},Me=(t,n=1e3,e)=>{const{immediate:r=!1}=e??{};let o=null;const i=()=>{o=setInterval(()=>{pt(t)},n)},s=()=>{o&&(clearInterval(o),o=null)};return r===!0&&i(),{start:i,stop:s}},De=(t,n=3e3,e)=>{const{immediate:r=!1}=e??{};let o=null;const i=(u=!1)=>{u===!0&&s(),o=setTimeout(()=>{pt(t)},n)},s=()=>{o&&(clearTimeout(o),o=null)};return r===!0&&i(),{start:i,stop:s}};class Fe{constructor(n){n&&this.setup(n),self.onerror=(e,r,o,i,s)=>{const u={source:r,lineno:o,colno:i,error:s};console.error(["=> worker process error",u]),this.send({type:"error",data:u})}}setup(n){self.onmessage=e=>{const{type:r}=e.data,o=n[r];if(typeof o=="function"){const i=o(e.data);i instanceof Promise&&i.catch(s=>{console.error(["=> worker process error",s]),this.send({type:"error",data:s})})}}}send(n){self.postMessage(n)}}let p=null;const ht=new ut,Ve=()=>{const t=$e();return[...Pe(t)].map(r=>r.toString(16).padStart(2,"0")).slice(0,6).join(":")},He=t=>{let n="";const{data:e}=t;if(e instanceof ArrayBuffer){const o=new Uint8Array(e).slice(10);for(const i of o)n+=String.fromCharCode(i)}else n=e;return n},We=Ve(),Ye=1e4,qe=1e3,Be={async createSocket(t){const{type:n,reqId:e,data:r}=t,{url:o,isHeartbeat:i}=r,s=De(()=>{console.warn("=> socket message timeout",r.url)},Ye),u=Me(()=>{p&&p.readyState===p.OPEN&&(p.send(We),i||y.send({type:"heartbeat",data:!0}))},qe);p=new WebSocket(o),p.binaryType="arraybuffer",p.onopen=()=>{console.info(["=> socket open",o]),y.send({type:n,reqId:e}),y.send({type:"open",data:!0}),u.start()},p.onmessage=f=>{i&&y.send({type:"heartbeat",data:!0}),s.start(!0);const a=He(f);a&&(y.send({type:"message",data:a}),ht.next(a))},p.onerror=()=>{u.stop(),s.stop(),console.error(["=> socket error",o]),y.send({type:"error",data:{url:o}})},p.onclose=f=>{const{reason:a,code:c}=f;u.stop(),s.stop(),y.send({type:"close",data:{reason:a,code:c}}),console.info(["=> socket closed",{url:o,reason:a,code:c}])}},closeSocket(){console.info(["=> active close socket."]),p&&(p.close(3001,"active disconnect"),p=null)},execCmd(t){const{type:n,reqId:e,data:r}=t;let o,i=r.cmd;typeof r.args=="string"&&r.args.length>0&&(i=`${i} ${r.args}`);const s=()=>new Promise(f=>{p==null||p.send(`${i}
`),console.log(["socket send",i]),r.type==="get"?o=ht.subscribe(a=>{if(a.startsWith(r.cmd)){const c=le(pe(a,r.cmd));f(c)}}):f(r)}),u=r.timeout??5e3;je(s,u,new Error(`get '${r.cmd}' data timeout.`)).then(f=>{y.send({type:n,reqId:e,data:f})}).catch(f=>{console.error(f),y.send({type:n,reqId:e,data:""})}).finally(()=>{o==null||o.unsubscribe()})}},y=new Fe;y.setup(Be)})();
